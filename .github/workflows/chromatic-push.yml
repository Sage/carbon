name: Chromatic Push

on:
  push:
    # We need these branches to update their baselines when they are merged into
    branches:    
      - master
      - '[0-9]+.x'
      - '[0-9]+.x.x'
      - '[0-9]+.[0-9]+.x'
      - trigger-integration # This branch is used to update checks on PR's from forks
      - 'major/**'

jobs:
  chromatic:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0
    - uses: actions/setup-node@v1
      with:
        node-version: '12'
    - run: npm ci
    - uses: chromaui/action@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
        exitOnceUploaded: true # We don't want it to fail CI, we'll be using the GitHub Check