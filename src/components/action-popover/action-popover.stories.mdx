import { Meta, Story, Preview, Props} from '@storybook/addon-docs/blocks';
import { Basic, Classic } from './action-popover.stories';
import { Preview as MyPreview } from '@storybook/components';
import {  
  ActionPopover, ActionPopoverDivider, ActionPopoverItem, ActionPopoverMenu
} from '.';
import { MenuItem } from './action-popover-item.component';
import {
  Table, TableRow, TableCell, TableHeader
} from '../table';
import Button from '../button';
import DocsWrapper from '../../../.storybook/docs-helpers/components/iframe-wrapper';

<Meta title="Design System/ActionPopover" parameters={{ info: { disable: true }}}/>

# ActionPopover

ActionPopovers present a handy list of actions the user can perform on a whole table, a specific row within a table, or a tile.

Click the ellipsis icon to show actions the user can take on a specific table row, for example, emailing the invoice.

## Designer Notes
- Action Popovers only perform commands - they aren’t used to collect data, or choose between data items as in a form.
- Place the most common and useful actions within them. Although designs for separator rows and sub-menus are provided, 
these add complexity, so use them sparingly.
- Clicking the table row or tile links the user to that item. Only clicking the Action Popover's icon displays its items.
- Action popovers appear in front of all other UI elements.
- If they are in a position to be cut off by the browser or screen’s edge, the Action Popover can instead appear to the 
left, right, or above the element that generates it.
- Content in the popover is usually left aligned.

## Related Components
- Data entry rather than an action? [Try Select](/components/__experimental__/select "Try Select").
- Only a single action? [Try Button](/components/button/ "Try Button").
- Doesn’t relate to a single table row or tile? [Try Split Button](/components/split-button "Try Split Button"), or 
[Try Multi-Action Button](/components/multi-action-button "Try Multi-Action Button").


<Story id="test-action-popover--default" />

<Story id="test-action-popover--classic" />

## With all items interactive
Each item is clickable and represents an action to be taken on a given row.
<Preview>
  <Story name="popover with icons" parameters={{ info: { disable: true }}}>
    <div style={{ height: '250px' }}>
      <Table>
        <TableRow>
          <TableHeader>First Name</TableHeader>
          <TableHeader>Last Name</TableHeader>
          <TableHeader>&nbsp;</TableHeader>
        </TableRow>
        <TableRow>
          <TableCell>John</TableCell>
          <TableCell>Doe</TableCell>
          <TableCell>
            <ActionPopover>
              <ActionPopoverItem
                icon='email'
                onClick={() => {}}
              >
                Email Invoice
              </ActionPopoverItem>
              <ActionPopoverDivider />
              <ActionPopoverItem onClick={() => {}} icon='delete'>Delete</ActionPopoverItem>
            </ActionPopover>
          </TableCell>
        </TableRow>
      </Table>
    </div>
  </Story>
</Preview>

ActionPopoverItem&apos;s can be disabled and will not dispatch an action but can still be navigated.
<Preview>
  <Story name="with disabled item" parameters={{ info: { disable: true }}}>
    <div style={{ height: '250px' }}>
      <Table>
        <TableRow>
          <TableHeader>First Name</TableHeader>
          <TableHeader>Last Name</TableHeader>
          <TableHeader>&nbsp;</TableHeader>
        </TableRow>
        <TableRow>
          <TableCell>John</TableCell>
          <TableCell>Doe</TableCell>
          <TableCell>
            <ActionPopover>
              <ActionPopoverItem
                icon='email'
                disabled
                onClick={() => {}}
              >
                Email Invoice
              </ActionPopoverItem>
              <ActionPopoverDivider />
              <ActionPopoverItem onClick={() => {}} icon='delete'>Delete</ActionPopoverItem>
            </ActionPopover>
          </TableCell>
        </TableRow>
      </Table>
    </div>
  </Story>
</Preview>

It is possible to align the Menu to the right of the MenuButton by passing the &quot;rightAlignMenu&quot; to ActionPopover
<Preview>
  <Story name="with menu right aligned" parameters={{ info: { disable: true }}}>
    <div style={{ height: '250px' }}>
      <Table>
        <TableRow>
          <TableHeader>First Name</TableHeader>
          <TableHeader>Last Name</TableHeader>
          <TableHeader>&nbsp;</TableHeader>
        </TableRow>
        <TableRow>
          <TableCell>John</TableCell>
          <TableCell>Doe</TableCell>
          <TableCell>
            <ActionPopover rightAlignMenu>
              <ActionPopoverItem
                icon='email'
                disabled
                onClick={() => {}}
              >
                Email Invoice
              </ActionPopoverItem>
              <ActionPopoverDivider />
              <ActionPopoverItem onClick={() => {}} icon='delete'>Delete</ActionPopoverItem>
            </ActionPopover>
          </TableCell>
        </TableRow>
      </Table>
    </div>
  </Story>
</Preview>

Menu items can also be displayed without icons.
<Preview>
  <Story name="with no icons" parameters={{ info: { disable: true }}}>
    <div style={{ height: '250px' }}>
      <Table>
        <TableRow>
          <TableHeader>First Name</TableHeader>
          <TableHeader>Last Name</TableHeader>
          <TableHeader>&nbsp;</TableHeader>
        </TableRow>
        <TableRow>
          <TableCell>John</TableCell>
          <TableCell>Doe</TableCell>
          <TableCell>
            <ActionPopover>
              <ActionPopoverItem onClick={() => {}}>
                Email Invoice
              </ActionPopoverItem>
              <ActionPopoverDivider />
              <ActionPopoverItem onClick={() => {}}>Delete</ActionPopoverItem>
            </ActionPopover>
          </TableCell>
        </TableRow>
      </Table>
    </div>
  </Story>
</Preview>


## With a custom Menu Button
It is possible to use the &quot;renderButton&quot; prop to override the default button used to trigger the opening and closing of 
ActionPopoverMenu. See the prop tables below for the properties surfaced to any custom component being passed in.
<Preview>
  <Story name="popover with custom button" parameters={{ info: { disable: true }}}>
    <div style={{ height: '250px' }}>
      <Table>
        <TableRow>
          <TableHeader>First Name</TableHeader>
          <TableHeader>Last Name</TableHeader>
          <TableHeader>&nbsp;</TableHeader>
        </TableRow>
        <TableRow>
          <TableCell>John</TableCell>
          <TableCell>Doe</TableCell>
          <TableCell>
            <ActionPopover renderButton={(props) => (
                <Button buttonType='tertiary' iconType='dropdown' iconPosition='after' { ...props }>More</Button>
              )}>
              <ActionPopoverItem
                icon='email'
                onClick={() => {}}
              >
                Email Invoice
              </ActionPopoverItem>
              <ActionPopoverDivider />
              <ActionPopoverItem onClick={() => {}} icon='delete'>Delete</ActionPopoverItem>
            </ActionPopover>
          </TableCell>
        </TableRow>
      </Table>
    </div>
  </Story>
</Preview>


## With a sub-menu
A menu item can be passed a sub-menu to add further sub-actions if needed. items with sub-menus will display an chevron 
icons pointing in the direction that the sub-menu will open; by default it will open to the left.

Hovering the mouse cursor over an item will open the sub-menu if it has one and moving the mouse cursor away will 
close it. No action is dispatched on click of the item and the sub-menu is opened by mouse enter and closed on mouse 
leave.

<Preview>
  <Story name="with submenu" parameters={{ info: { disable: true }}}>
    <div style={{ height: '250px' }}>
      <Table>
        <TableRow>
          <TableHeader>First Name</TableHeader>
          <TableHeader>Last Name</TableHeader>
          <TableHeader>&nbsp;</TableHeader>
        </TableRow>
        <TableRow>
          <TableCell>John</TableCell>
          <TableCell>Doe</TableCell>
          <TableCell>
            <ActionPopover>
              <ActionPopoverItem
                icon='print'
                onClick={() => {}}
                submenu={ 
                  <ActionPopoverMenu>
                    <ActionPopoverItem onClick={() => {}}>
                      CSV
                    </ActionPopoverItem>
                    <ActionPopoverItem onClick={() => {}}>
                      PDF
                    </ActionPopoverItem>
                  </ActionPopoverMenu> 
                }
              >
                Print
              </ActionPopoverItem>
              <ActionPopoverDivider />
              <ActionPopoverItem onClick={() => {}} icon='delete'>Delete</ActionPopoverItem>
            </ActionPopover>
          </TableCell>
        </TableRow>
      </Table>
    </div>
  </Story>
</Preview>

A sub-menu will not open if the item is in a disabled state.
<Preview>
  <Story name="with disabled submenu" parameters={{ info: { disable: true }}}>
    <div style={{ height: '250px' }}>
      <Table>
        <TableRow>
          <TableHeader>First Name</TableHeader>
          <TableHeader>Last Name</TableHeader>
          <TableHeader>&nbsp;</TableHeader>
        </TableRow>
        <TableRow>
          <TableCell>John</TableCell>
          <TableCell>Doe</TableCell>
          <TableCell>
            <ActionPopover>
              <ActionPopoverItem
                disabled
                icon='print'
                onClick={() => {}}
                submenu={ 
                  <ActionPopoverMenu>
                    <ActionPopoverItem onClick={() => {}}>
                      CSV
                    </ActionPopoverItem>
                    <ActionPopoverItem onClick={() => {}}>
                      PDF
                    </ActionPopoverItem>
                  </ActionPopoverMenu> 
                }
              >
                Print
              </ActionPopoverItem>
              <ActionPopoverDivider />
              <ActionPopoverItem onClick={() => {}} icon='delete'>Delete</ActionPopoverItem>
            </ActionPopover>
          </TableCell>
        </TableRow>
      </Table>
    </div>
  </Story>
</Preview>

The sub-menu will open to the right side when there is no space to render the sub-menu to the left.
<Story name="with submenu aligned right" parameters={{ docs: { disable: true }, info: { disable: true }}}>
  <div style={{ height: '250px' }}>
    <Table>
      <TableRow>
        <TableHeader>&nbsp;</TableHeader>
        <TableHeader>First Name</TableHeader>
        <TableHeader>Last Name</TableHeader>
      </TableRow>
      <TableRow>
        <TableCell>
          <ActionPopover>
            <ActionPopoverItem
              icon='print'
              onClick={() => {}}
              submenu={ 
                <ActionPopoverMenu>
                  <ActionPopoverItem icon='csv' onClick={() => {}}>
                    CSV
                  </ActionPopoverItem>
                  <ActionPopoverItem icon='pdf' onClick={() => {}}>
                    PDF
                  </ActionPopoverItem>
                </ActionPopoverMenu> 
              }
            >
              Print
            </ActionPopoverItem>
            <ActionPopoverDivider />
            <ActionPopoverItem onClick={() => {}} icon='delete'>Delete</ActionPopoverItem>
          </ActionPopover>
        </TableCell>
        <TableCell>John</TableCell>
        <TableCell>Doe</TableCell>
      </TableRow>
    </Table>
  </div>
</Story>

<MyPreview>
  <DocsWrapper 
    src='iframe.html?id=design-system-actionpopover--with-submenu-aligned-right'
    height='250px'
  />
</MyPreview>

## Keyboard navigation 
ActionPopover and ActionPopoverItem have extensive keyboard support. It is possible to open the menu when the
ActionPopover is focused: pressing either the "enter" or "down" key will open the menu and focus the first item; 
pressing the "up" key when the button is focused will open the menu and focus the last element.

Once the menu is open, it is possible to navigate the items using the "up" and "down" arrow keys. Alpha keys can also 
be used as shortcuts to navigate the items: pressing a-z selects the next item in the list starting with that letter, 
wrapping around to the start if required. Pressing an alpha key which doesn't match any items in the menu list will 
result leave the focus on the current item.

Pressing the "enter" key will trigger the action associated with the currently focused item. Pressing either the "esc" 
or "tab" key will close the menu with no action being triggered and focus the next focusable element. Pressing 
"shift + tab" will close the menu and focus the previously focused element.
<Preview>
  <Story name="keyboard access" parameters={{ info: { disable: true }}}>
    <div style={{ height: '250px' }}>
      <Table>
        <TableRow>
          <TableHeader>First Name</TableHeader>
          <TableHeader>Last Name</TableHeader>
          <TableHeader>&nbsp;</TableHeader>
        </TableRow>
        <TableRow>
          <TableCell>John</TableCell>
          <TableCell>Doe</TableCell>
          <TableCell>
            <ActionPopover>
              <ActionPopoverItem
                icon='email'
                onClick={() => {}}
              >
                Email Invoice
              </ActionPopoverItem>
              <ActionPopoverItem
                disabled
                icon='csv'
                onClick={() => {}}
              >
                Download CSV
              </ActionPopoverItem>
              <ActionPopoverItem
                icon='pdf'
                onClick={() => {}}
              >
                Download PDF
              </ActionPopoverItem>
              <ActionPopoverDivider />
              <ActionPopoverItem onClick={() => {}} icon='delete'>Delete</ActionPopoverItem>
            </ActionPopover>
          </TableCell>
        </TableRow>
      </Table>
    </div>
  </Story>
</Preview>

Sub-menus can be accessed via the keyboard as well, when the sub-menu is left aligned it can be opened by navigating to 
the parent item and pressing the "left" key. The same accessible shortcuts described above can then be used to navigate 
the sub-menu. Pressing the "right" key will return focus back to the main menu and close the sub-menu without 
triggering an action. 
<Preview>
  <Story name="keyboard access left aligned submenu" parameters={{ info: { disable: true }}}>
    <div style={{ height: '250px' }}>
      <Table>
        <TableRow>
          <TableHeader>First Name</TableHeader>
          <TableHeader>Last Name</TableHeader>
          <TableHeader>&nbsp;</TableHeader>
        </TableRow>
        <TableRow>
          <TableCell>John</TableCell>
          <TableCell>Doe</TableCell>
          <TableCell>
            <ActionPopover>
              <ActionPopoverItem
                icon='csv'
                onClick={() => {}}
                submenu={ 
                  <ActionPopoverMenu>
                    <ActionPopoverItem icon='csv' onClick={() => {}}>
                      CSV
                    </ActionPopoverItem>
                    <ActionPopoverItem icon='pdf' onClick={() => {}}>
                      PDF
                    </ActionPopoverItem>
                  </ActionPopoverMenu> 
                }
              >
                Download
              </ActionPopoverItem>
              <ActionPopoverItem
                icon='pdf'
                onClick={() => {}}
                submenu={ 
                  <ActionPopoverMenu>
                    <ActionPopoverItem icon='csv' onClick={() => {}}>
                      CSV
                    </ActionPopoverItem>
                    <ActionPopoverItem icon='pdf' onClick={() => {}}>
                      PDF
                    </ActionPopoverItem>
                  </ActionPopoverMenu> 
                }
              >
                Print
              </ActionPopoverItem>
              <ActionPopoverDivider />
              <ActionPopoverItem onClick={() => {}} icon='delete'>Delete</ActionPopoverItem>
            </ActionPopover>
          </TableCell>
        </TableRow>
      </Table>
    </div>
  </Story>
</Preview>

When sub-menus aligns to the right hand side, the key shortcuts are switiched: pressingt the "right" key whilst focus 
is on a item will open a sub-menu if it has one and pressing the "left" key will close it. 
<Story name="keyboard access right aligned submenu" parameters={{ docs: { disable: true }, info: { disable: true }}}>
  <div style={{ height: '250px' }}>
  <Table>
    <TableRow>
      <TableHeader>&nbsp;</TableHeader>
      <TableHeader>First Name</TableHeader>
      <TableHeader>Last Name</TableHeader>
    </TableRow>
    <TableRow>
      <TableCell>
        <ActionPopover>
          <ActionPopoverItem
            icon='csv'
            onClick={() => {}}
            submenu={ 
              <ActionPopoverMenu>
                <ActionPopoverItem icon='csv' onClick={() => {}}>
                  CSV
                </ActionPopoverItem>
                <ActionPopoverItem icon='pdf' onClick={() => {}}>
                  PDF
                </ActionPopoverItem>
              </ActionPopoverMenu> 
            }
          >
            Download
          </ActionPopoverItem>
          <ActionPopoverItem
            icon='pdf'
            onClick={() => {}}
            submenu={ 
              <ActionPopoverMenu>
                <ActionPopoverItem icon='csv' onClick={() => {}}>
                  CSV
                </ActionPopoverItem>
                <ActionPopoverItem icon='pdf' onClick={() => {}}>
                  PDF
                </ActionPopoverItem>
              </ActionPopoverMenu> 
            }
          >
            Print
          </ActionPopoverItem>
          <ActionPopoverDivider />
          <ActionPopoverItem onClick={() => {}} icon='delete'>Delete</ActionPopoverItem>
        </ActionPopover>
      </TableCell>
      <TableCell>John</TableCell>
      <TableCell>Doe</TableCell>
    </TableRow>
  </Table>
  </div>
</Story>

<MyPreview>
  <DocsWrapper
    src='iframe.html?id=design-system-actionpopover--keyboard-access-right-aligned-submenu'
    height='250px'
  />
</MyPreview>

## Services Column

The ActionPopover can be composed in a number of ways: below is an example of a services column popover that is 
populated with any additional overflow options for a given row. The popover's height is dynamic to the content placed 
within it. Beyond a reasonable number of items, content may be truncated and the foot of the popover may then contain 
a &quot;Manage&quot; option.

<Preview>
  <Story name="services column">
    <div style={ { marginTop: '40px', height: '275px', maxWidth: '800px' } }>
      <Table isZebra>
        <TableRow>
          <TableHeader colSpan='3'>Services</TableHeader>
        </TableRow>
        <TableRow>
          <TableCell>Accounting</TableCell>
          <TableCell>Payroll</TableCell>
          <TableCell>
            <ActionPopover
              rightAlignMenu
              renderButton={ ({ styleOverride, tabIndex, ...rest }) => (
                <Button
                  buttonType='tertiary'
                  iconType='dropdown'
                  iconPosition='after'
                  size='small'
                  tabIndex={ tabIndex }
                  styleOverride={ styleOverride }
                  date-element={ rest['data-element'] }
                >
                  More
                </Button>
              ) }
            >
              <ActionPopoverItem onClick={ () => {} }>Auto Entry</ActionPopoverItem>
              <ActionPopoverItem onClick={ () => {} }>Corporation Tax</ActionPopoverItem>
              <ActionPopoverItem onClick={ () => {} }>Final Accounts</ActionPopoverItem>
              <ActionPopoverItem onClick={ () => {} }>VAT Centre</ActionPopoverItem>
              <ActionPopoverDivider />
              <ActionPopoverItem onClick={ () => {} }>Manage Services</ActionPopoverItem>
            </ActionPopover>
          </TableCell>
        </TableRow>
        <TableRow>
          <TableCell>Accounting</TableCell>
          <TableCell>Payroll</TableCell>
          <TableCell>
            <ActionPopover
              rightAlignMenu
              renderButton={ ({ styleOverride, tabIndex, ...rest }) => (
                <Button
                  buttonType='tertiary'
                  iconType='dropdown'
                  iconPosition='after'
                  size='small'
                  tabIndex={ tabIndex }
                  styleOverride={ styleOverride }
                  date-element={ rest['data-element'] }
                >
                  More
                </Button>
              ) }
            >
              <ActionPopoverItem onClick={ () => {} }>Auto Entry</ActionPopoverItem>
              <ActionPopoverItem onClick={ () => {} }>Corporation Tax</ActionPopoverItem>
              <ActionPopoverItem onClick={ () => {} }>Final Accounts</ActionPopoverItem>
              <ActionPopoverItem onClick={ () => {} }>VAT Centre</ActionPopoverItem>
              <ActionPopoverDivider />
              <ActionPopoverItem onClick={ () => {} }>Manage Services</ActionPopoverItem>
            </ActionPopover>
          </TableCell>
        </TableRow>
      </Table>
    </div>
  </Story>
</Preview>

### ActionPopover Props
<Props of={ActionPopover} />

### ActionPopoverMenu Props
<Props of={ActionPopoverMenu} />

### ActionPopoverItem Props
<Props of={MenuItem} />
