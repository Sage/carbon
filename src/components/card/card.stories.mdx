import { useState, useRef } from "react";
import { DndProvider, useDrag, useDrop } from "react-dnd";
import Backend from "react-dnd-html5-backend";
import { Meta, Story, Canvas, ArgsTable } from "@storybook/addon-docs";
import { Card, CardRow, CardFooter, CardColumn } from ".";
import Heading from "../heading";
import Link from "../link";
import Typography from "../typography";
import Icon from "../icon";
import Button from "../button";
import Box from "../box";
import IconButton from "../icon-button";
import VerticalDivider from "../vertical-divider";
import StyledSystemProps from "../../../.storybook/utils/styled-system-props";
import { DraggableContainer, DraggableItem } from "../../components/draggable";

<Meta title="Card" parameters={{ info: { disable: true } }} />

# Card

Organise and present content and actions about a single subject.

## Contents

- [Quick Start](#quick-start)
- [Designer Notes](#designer-notes)
- [Examples](#examples)
- [Props](#props)

## Quick start

```javascript
import {
  Card,
  CardRow,
  CardFooter,
  CardColumn,
} from "carbon-react/lib/components/card";
```

## Designer Notes

- Cards: contain interactive content or controls.
  Sometimes it might be possible to move them around on the page. They have shadows - 'card shadow' as a default,
  and depth level 1 on hover.
- Cards may have hover and dragging states, whereas tiles do not.
- Neither cards nor tiles scroll.
- The primary action area of a card is typically the card itself.
  Often cards are one large touch target to a detail screen on a subject.
- When an array of cards or tiles are shown together,
  they may wrap into a grid depending on the available width and height of their container.

## Examples

### Default - medium spacing

<Canvas>
  <Story name="default">
    <Card>
      <CardRow>
        <CardColumn align="left">
          <Heading title="Stripe - [account name]" divider={false} />
          <Typography variant="h5">user.name@sage.com</Typography>
        </CardColumn>
        <CardColumn align="right">
          <Icon type="image" />
        </CardColumn>
      </CardRow>
      <CardRow>
        <CardColumn>
          <Typography variant="h5" weight="bold">
            Stripe Balance
          </Typography>
          <Heading title="£ 0.00" divider={false} />
          <Typography>LAST ENTRY: 15 DAYS AGO</Typography>
        </CardColumn>
      </CardRow>
      <CardFooter>
        <CardColumn>
          <Link icon="link" href="https://carbon.sage.com/">
            View Stripe Dashboard
          </Link>
        </CardColumn>
      </CardFooter>
    </Card>
  </Story>
</Canvas>

### Small spacing

<Canvas>
  <Story name="small spacing">
    <Card spacing="small">
      <CardRow>
        <CardColumn align="left">
          <Heading title="Stripe - [account name]" divider={false} />
          <Typography variant="h5">user.name@sage.com</Typography>
        </CardColumn>
        <CardColumn align="right">
          <Icon type="image" />
        </CardColumn>
      </CardRow>
      <CardRow pt={2} pb={2}>
        <CardColumn>
          <Typography variant="h5" weight="bold">
            Stripe Balance
          </Typography>
          <Heading title="£ 0.00" divider={false} />
          <Typography>LAST ENTRY: 15 DAYS AGO</Typography>
        </CardColumn>
      </CardRow>
      <CardFooter>
        <CardColumn>
          <Link icon="link" href="https://carbon.sage.com/">
            View Stripe Dashboard
          </Link>
        </CardColumn>
      </CardFooter>
    </Card>
  </Story>
</Canvas>

### Large spacing

<Canvas>
  <Story name="large spacing">
    <Card spacing="large">
      <CardRow>
        <CardColumn align="left">
          <Heading title="Stripe - [account name]" divider={false} />
          <Typography variant="h5">user.name@sage.com</Typography>
        </CardColumn>
        <CardColumn align="right">
          <Icon type="image" />
        </CardColumn>
      </CardRow>
      <CardRow pt={4} pb={4}>
        <CardColumn>
          <Typography variant="h5" weight="bold">
            Stripe Balance
          </Typography>
          <Heading title="£ 0.00" divider={false} />
          <Typography>LAST ENTRY: 15 DAYS AGO</Typography>
        </CardColumn>
      </CardRow>
      <CardFooter>
        <CardColumn>
          <Link icon="link" href="https://carbon.sage.com/">
            View Stripe Dashboard
          </Link>
        </CardColumn>
      </CardFooter>
    </Card>
  </Story>
</Canvas>

### With cardWidth provided

<Canvas>
  <Story name="with cardWidth provided">
    <Card cardWidth="300px">
      <CardRow>
        <CardColumn align="left">
          <Heading title="Stripe - [account name]" divider={false} />
          <Typography variant="h5">user.name@sage.com</Typography>
        </CardColumn>
        <CardColumn align="right">
          <Icon type="image" />
        </CardColumn>
      </CardRow>
      <CardRow>
        <CardColumn>
          <Typography variant="h5" weight="bold">
            Stripe Balance
          </Typography>
          <Heading title="£ 0.00" divider={false} />
          <Typography>LAST ENTRY: 15 DAYS AGO</Typography>
        </CardColumn>
      </CardRow>
      <CardFooter>
        <CardColumn>
          <Link icon="link" href="https://carbon.sage.com/">
            View Stripe Dashboard
          </Link>
        </CardColumn>
      </CardFooter>
    </Card>
  </Story>
</Canvas>

### Interactive

Click on the card to see the effect

<Canvas>
  <Story name="interactive" parameters={{ chromatic: { disable: true } }}>
    {() => {
      const [clickCounter, setClickCounter] = useState(0);
      return (
        <div>
          <Typography variant="b">
            Card has been clicked {clickCounter} times
          </Typography>
          <Card
            interactive
            action={() => setClickCounter((prevCounter) => prevCounter + 1)}
          >
            <CardRow>
              <CardColumn align="left">
                <Heading title="Stripe - [account name]" divider={false} />
                <Typography variant="h5">user.name@sage.com</Typography>
              </CardColumn>
              <CardColumn align="right">
                <Icon type="image" />
              </CardColumn>
            </CardRow>
            <CardRow>
              <CardColumn>
                <Typography variant="h5" weight="bold">
                  Stripe Balance
                </Typography>
                <Heading title="£ 0.00" divider={false} />
                <Typography>LAST ENTRY: 15 DAYS AGO</Typography>
              </CardColumn>
            </CardRow>
            <CardFooter>
              <CardColumn>
                <Link icon="link" href="https://carbon.sage.com/">
                  View Stripe Dashboard
                </Link>
              </CardColumn>
            </CardFooter>
          </Card>
        </div>
      );
    }}
  </Story>
</Canvas>

### Different `<CardRow />` padding

<Canvas>
  <Story
    name="different CardRow padding"
    parameters={{ chromatic: { disable: true } }}
  >
    <Card>
      <CardRow pt={2} pb={0}>
        <CardColumn align="left">
          <Heading title="Stripe - [account name]" divider={false} />
          <Typography variant="h5">user.name@sage.com</Typography>
        </CardColumn>
        <CardColumn align="right">
          <Icon type="image" />
        </CardColumn>
      </CardRow>
      <CardRow pt={0} pb={4}>
        <CardColumn>
          <Typography variant="h5" weight="bold">
            Stripe Balance
          </Typography>
          <Heading title="£ 0.00" divider={false} />
          <Typography>LAST ENTRY: 5 DAYS AGO</Typography>
        </CardColumn>
      </CardRow>
      <CardRow pt={0} pb={4}>
        <CardColumn>
          <Typography variant="h5" weight="bold">
            Stripe Balance
          </Typography>
          <Heading title="£ 0.00" divider={false} />
          <Typography>LAST ENTRY: 15 DAYS AGO</Typography>
        </CardColumn>
      </CardRow>
      <CardFooter>
        <CardColumn>
          <Link icon="link" href="https://carbon.sage.com/">
            View Stripe Dashboard
          </Link>
        </CardColumn>
      </CardFooter>
    </Card>
  </Story>
</Canvas>

### Different `<CardFooter />` padding

<Canvas>
  <Story
    name="different CardFooter padding"
    parameters={{ chromatic: { disable: true } }}
  >
    <div>
      <Card>
        <CardFooter px={1} py={1}>
          <Box width="100%" display="flex" justifyContent="space-around">
            <Box flexGrow={1}>
              <Button p={0} buttonType="tertiary" iconType="edit">
                {" "}
                Edit Button
              </Button>
            </Box>
            <Box>
              <Button buttonType="primary"> Button </Button>
            </Box>
          </Box>
        </CardFooter>
      </Card>
      <Card>
        <CardFooter px={2} py={1}>
          <Box width="100%" display="flex" justifyContent="space-around">
            <Box flexGrow={1}>
              <Button p={0} buttonType="tertiary" iconType="edit">
                {" "}
                Edit Button
              </Button>
            </Box>
            <Box>
              <Button buttonType="primary"> Button </Button>
            </Box>
          </Box>
        </CardFooter>
      </Card>
      <Card>
        <CardFooter px={3} py={1}>
          <Box width="100%" display="flex" justifyContent="space-around">
            <Box flexGrow={1}>
              <Button p={0} buttonType="tertiary" iconType="edit">
                {" "}
                Edit Button
              </Button>
            </Box>
            <Box>
              <Button buttonType="primary"> Button </Button>
            </Box>
          </Box>
        </CardFooter>
      </Card>
      <Card>
        <CardFooter px={4} py={1}>
          <Box width="100%" display="flex" justifyContent="space-around">
            <Box flexGrow={1}>
              <Button p={0} buttonType="tertiary" iconType="edit">
                {" "}
                Edit Button
              </Button>
            </Box>
            <Box>
              <Button buttonType="primary"> Button </Button>
            </Box>
          </Box>
        </CardFooter>
      </Card>
      <Card>
        <CardFooter px={5} py={1}>
          <Box width="100%" display="flex" justifyContent="space-around">
            <Box flexGrow={1}>
              <Button p={0} buttonType="tertiary" iconType="edit">
                {" "}
                Edit Button
              </Button>
            </Box>
            <Box>
              <Button buttonType="primary"> Button </Button>
            </Box>
          </Box>
        </CardFooter>
      </Card>
      <Card>
        <CardFooter px={5} py={2}>
          <Box width="100%" display="flex" justifyContent="space-around">
            <Box flexGrow={1}>
              <Button p={0} buttonType="tertiary" iconType="edit">
                {" "}
                Edit Button
              </Button>
            </Box>
            <Box>
              <Button buttonType="primary"> Button </Button>
            </Box>
          </Box>
        </CardFooter>
      </Card>
    </div>
  </Story>
</Canvas>

### More `<CardFooter />` examples

<Canvas>
  <Story name="more examples of CardFooter">
    <div>
      <Card>
        <CardFooter p={1}>
          <Box
            alignItems="center"
            width="100%"
            display="flex"
            justifyContent="space-around"
          >
            <Box flexGrow={1}>
              <IconButton>
                <Icon bgSize="medium" type="phone" />
              </IconButton>
              <IconButton>
                <Icon bgSize="medium" type="phone" />
              </IconButton>
              <IconButton>
                <Icon bgSize="medium" type="phone" />
              </IconButton>
              <IconButton>
                <Icon bgSize="medium" type="phone" />
              </IconButton>
            </Box>
            <Box>
              <Button buttonType="tertiary"> Button </Button>
              <Button buttonType="primary" ml={2}>
                {" "}
                Button{" "}
              </Button>
            </Box>
          </Box>
        </CardFooter>
      </Card>
      <Card cardWidth="400px">
        <CardFooter px={2} py={1}>
          <Box
            width="100%"
            alignItems="center"
            display="flex"
            justifyContent="center"
          >
            <Button
              p={0}
              iconPosition="after"
              iconType="edit"
              buttonType="tertiary"
            >
              Edit Button
            </Button>
            <VerticalDivider tint={80} py={0} px={2} h={30} />
            <Button
              p={0}
              iconPosition="after"
              iconType="edit"
              buttonType="tertiary"
              ml={2}
            >
              Edit Button
            </Button>
            <VerticalDivider tint={80} py={0} px={2} h={30} />
            <Button
              p={0}
              iconPosition="after"
              iconType="edit"
              buttonType="tertiary"
              ml={2}
            >
              Edit Button
            </Button>
          </Box>
        </CardFooter>
      </Card>
      <Card cardWidth="400px">
        <CardFooter variant="transparent" px={2} py={1}>
          <Box
            width="100%"
            alignItems="center"
            display="flex"
            justifyContent="center"
          >
            <Button
              p={0}
              iconPosition="after"
              iconType="edit"
              buttonType="tertiary"
            >
              Edit Button
            </Button>
            <VerticalDivider tint={80} py={0} px={2} h={30} />
            <Button
              p={0}
              iconPosition="after"
              iconType="edit"
              buttonType="tertiary"
              ml={2}
            >
              Edit Button
            </Button>
            <VerticalDivider tint={80} py={0} px={2} h={30} />
            <Button
              p={0}
              iconPosition="after"
              iconType="edit"
              buttonType="tertiary"
              ml={2}
            >
              Edit Button
            </Button>
          </Box>
        </CardFooter>
      </Card>
      <Card>
        <CardFooter p={2}>
          <Box display="flex" width="100%" justifyContent="center">
            <Link icon="link" href="https://carbon.sage.com/">
              View Stripe Dashboard
            </Link>
          </Box>
        </CardFooter>
      </Card>
    </div>
  </Story>
</Canvas>

## With string as child

<Canvas>
  <Story
    name="with string as child"
    parameters={{ chromatic: { disable: true } }}
  >
    <div>
      <Card>String passed as child</Card>
    </div>
  </Story>
</Canvas>

## With draggable

Please note that you will need to visit the `Canvas` tab to be able to see the draggable behaviour in this example.

By using the `draggable` prop, Cards can be implemented to be draggable.

This example uses the `react-dnd` and `react-dnd-html5-backend` packages.

```javascript
import { DndProvider, useDrag, useDrop } from "react-dnd";
import Backend from "react-dnd-html5-backend";
```

<Canvas>
  <Story name="with draggable" parameters={{ chromatic: { disable: true } }}>
    {() => {
      const columnNames = {
        productOne: "Product One",
        productTwo: "Product Two",
      };
      const cards = [
        { id: 1, name: "Item 1", column: columnNames.productOne },
        { id: 2, name: "Item 2", column: columnNames.productOne },
        { id: 3, name: "Item 3", column: columnNames.productTwo },
        { id: 4, name: "Item 4", column: columnNames.productOne },
      ];
      const MovableItem = ({
        name,
        index,
        currentColumnName,
        setItems,
        dataElement,
      }) => {
        const changeItemColumn = (currentItem, columnName) => {
          setItems((prevState) => {
            return prevState.map((e) => {
              return {
                ...e,
                column: e.name === currentItem.name ? columnName : e.column,
              };
            });
          });
        };
        const ref = useRef(null);
        const [, drop] = useDrop({
          accept: "Card",
          hover(item, monitor) {
            if (!ref.current) {
              return;
            }
            const dragIndex = item.index;
            const hoverIndex = index;
            if (dragIndex === hoverIndex) {
              return;
            }
            const hoverBoundingRect = ref.current?.getBoundingClientRect();
            const hoverMiddleY =
              (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;
            const clientOffset = monitor.getClientOffset();
            const hoverClientY = clientOffset.y - hoverBoundingRect.top;
            if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {
              return;
            }
            if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {
              return;
            }
            item.index = hoverIndex;
          },
        });
        const [{ isDragging }, drag] = useDrag({
          item: {
            index,
            name,
            currentColumnName,
            type: "Card",
          },
          end: (item, monitor) => {
            const dropResult = monitor.getDropResult();
            if (dropResult) {
              const { name } = dropResult;
              const { productOne, productTwo } = columnNames;
              switch (name) {
                case productTwo:
                  changeItemColumn(item, productTwo);
                  break;
                case productOne:
                  changeItemColumn(item, productOne);
                  break;
                default:
                  break;
              }
            }
          },
          collect: (monitor) => ({
            isDragging: monitor.isDragging(),
          }),
        });
        const opacity = isDragging ? 0.4 : 1;
        drag(drop(ref));
        return (
          <div
            ref={ref}
            style={{
              opacity,
              borderRadius: "5px",
              backgroundColor: "#FAFDFF",
              height: "100px",
              width: "80%",
              margin: "16px auto",
              display: "flex",
              justifyContent: "center",
              alignItems: "center",
              boxShadow: "0px 0px 3px rgba(0, 0, 0, 0.5)",
            }}
          >
            <Card id={name} draggable data-element={dataElement}>
              <CardRow>
                <CardColumn align="left">
                  <Heading title={name} divider={false} />
                  <Typography>user.name@sage.com</Typography>
                </CardColumn>
                <CardColumn align="right">
                  <Icon type="image" />
                </CardColumn>
              </CardRow>
            </Card>
          </div>
        );
      };
      const Column = ({ children, title, dataElement }) => {
        const [{ isOver, canDrop }, drop] = useDrop({
          accept: "Card",
          drop: () => ({ name: title }),
          collect: (monitor) => ({
            isOver: monitor.isOver(),
            canDrop: monitor.canDrop(),
          }),
        });
        const getBackgroundColor = () => {
          if (isOver && canDrop) {
            return "rgb(0, 129, 93)";
          }
        };
        const getTextColor = () => {
          if (isOver && canDrop) {
            return "#FFFFFF";
          }
        };
        return (
          <Box
            ref={drop}
            style={{
              backgroundColor: getBackgroundColor(),
              borderRadius: "10px",
              boxShadow: "1px 1px 3px rgba(0, 0, 0, 0.5)",
              border: "2px solid #7d7d7d",
              height: "max-content",
              minHeight: "100px",
              width: "260px",
              display: "flex",
              justifyContent: "center",
              flexWrap: "wrap",
            }}
            m={2}
            data-element={dataElement}
          >
            <Typography variant="p" color={getTextColor()}>
              {title}
            </Typography>
            {children}
          </Box>
        );
      };
      const [items, setItems] = useState(cards);
      const moveCardHandler = (dragIndex, hoverIndex) => {
        const dragItem = items[dragIndex];
        if (dragItem) {
          setItems((prevState) => {
            const copiedStateArray = [...prevState];
            const prevItem = copiedStateArray.splice(hoverIndex, 1, dragItem);
            copiedStateArray.splice(dragIndex, 1, prevItem[0]);
            return copiedStateArray;
          });
        }
      };
      const returnItemsForColumn = (columnName) => {
        return items
          .filter((item) => item.column === columnName)
          .map((item, index) => (
            <MovableItem
              key={item.id}
              name={item.name}
              currentColumnName={item.column}
              setItems={setItems}
              index={index}
              moveCardHandler={moveCardHandler}
              dataElement={`draggable-card-${item.id}`}
            />
          ));
      };
      const { productOne, productTwo } = columnNames;
      return (
        <Box width="700px" height="450px">
          <div
            style={{
              display: "flex",
              flexDirection: "row",
              justifyContent: "space-around",
            }}
          >
            <DndProvider backend={Backend}>
              <Column title={productOne} dataElement="draggable-container-1">
                {returnItemsForColumn(productOne)}
              </Column>
              <Column title={productTwo} dataElement="draggable-container-2">
                {returnItemsForColumn(productTwo)}
              </Column>
            </DndProvider>
          </div>
        </Box>
      );
    }}
  </Story>
</Canvas>

## Props

### Card

<StyledSystemProps noHeader margin of={Card} />

### CardRow

<StyledSystemProps noHeader padding of={CardRow} />

### CardColumn

<ArgsTable of={CardColumn} />

### CardFooter

<StyledSystemProps spacing noHeader of={CardFooter} />
