import { useState } from 'react';
import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';

import { AccordionGroup, Accordion } from '.';
import Textbox from '../../__experimental__/components/textbox';
import Button from '../button';
import { Dl, Dt, Dd } from '../definition-list';

<Meta
  title="Design System/Accordion"
  parameters={{ info: { disable: true }}}
/>

# Accordion
Group, hide and show content.

## Overview
Accordions are a good progressive disclosure technique - initially showing only top-level information, but allowing the user quick access to more on request. But, they can confuse users sometimes, so use them sparingly.

## Guidance, hints and tips

Don’t put accordions within accordions.

Don’t hide important controls within accordions - for example, primary actions should always be outside them.

Accordions expand and collapse vertically. If there are lots, or content is extensive, be careful that the user doesn’t become confused, lose their place, or have problems with discoverability. Use them sparingly for these reasons.

Accordions should remain open or closed until a user interacts with them. Consider whether multiple, or only one accordion section can be open at a time.

An arrow icon pointing down indicates that the accordion is closed.

An arrow icon pointing up indicates that the accordion is open.

The icon can animate when a transition is made.

The user can click the icon directly, the text label, or the text label’s background to action the accordion.

## Quick Start

To use accordion, import the `Accordion` and pass the content as children.

It can be used as a controlled component where the expansion state is controlled externally,
in that case both `onChange` and `expanded` props are required.

```jsx
import { Accordion } from "carbon-react/lib/components/accordion"

const MyComponent = () => (
  <Accordion onChange={ onChange } expanded={ expanded } title="Title">
    <p>Content as a children</p>
  </Accordion>
);
```

It can also be used as an uncontrolled component where the expansion state is controlled internally.
It is still possible to pass `onChange` to hook a callback for state changes, however to set initial expansion state `defaultExpanded` can be passed.

```jsx
import { Accordion } from "carbon-react/lib/components/accordion"

const MyComponent = () => (
  <Accordion onChange={ onChange } defaultExpanded={ true } title="Title">
    <p>Content as a children</p>
  </Accordion>
);
```

## Visuals

### Default
Default version of accordion has white background and no side borders.
<Preview>
  <Story name="default">
    <Accordion title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Transparent
Transparent scheme has transparent background.
<Preview>
  <Story name="transparent">
    <Accordion scheme="transparent" title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Small
Small version has a smaller heading and less padding.
<Preview>
  <Story name="small">
    <Accordion size="small" title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Sub title
A sub title can be added when the size is large (default).
<Preview>
  <Story name="sub title">
    <Accordion subTitle='Sub title' title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Full border
The accordion can have side borders along with the default top and bottom.
<Preview>
  <Story name="full border">
    <Accordion borders='full' title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Left aligned icon
The accordion icon can be left aligned.
<Preview>
  <Story name="icon left">
    <Accordion iconAlign='left' title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Different width
The default width of 100% can be overriden.
<Preview>
  <Story name="different width">
    <Accordion width="500px" title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Custom padding
Extra padding be be added top and bottom.
<Preview>
  <Story name="custom padding">
    <Accordion customPadding={50} title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Grouped
Accordions borders collapse when positioned next to each other making it easy to group them.
To achieve proper keyboard accessibility as described in `W3` sources it is required to wrap neighbouring accordions in
`AccordionGroup`.

```jsx
import { Accordion, AccordionGroup } from "carbon-react/lib/components/accordion"
```

<Preview>
  <Story id="design-system-accordion-test--grouped" name="grouped">
  </Story>
</Preview>

### With dynamic content
Accordion adjust it's height properly when it's content is being dynamically changed

<Preview>
  <Story name="with dynamic content">
    {() => {
      const [contentCount, setContentCount] = useState(3);
      const modifyContentCount = modifier => {
        if(modifier === 1) {
          setContentCount(contentCount + 1)
        }
        if (modifier === -1 && contentCount > 0) {
          setContentCount(contentCount - 1)
        }
      }
      return (
        <>
          <Button onClick={ () => modifyContentCount(1) }>Add content</Button>
          <Button onClick={ () => modifyContentCount(-1) }>Remove content</Button>
          <Accordion title="Title">
            {Array.from({ length: contentCount }).map((_, index) => <div key={ index }>Content</div>)}
          </Accordion>
        </>
      )
    }}
  </Story>
</Preview>


### With overriden styles
Accordion styles can be easily overriden by providing `styleOverride` prop with proper structure as defined in propTypes.

<Preview>
  <Story name="styles overriden">
    <Accordion
      title='Heading'
      styleOverride={
        {
          headerArea: {
            padding: '24px',
            marginLeft: 'calc(15% - 24px)'
          },
          content: { paddingLeft: 0 }
        }
      }
    >
      <Textbox
        label='Label 1'
        labelInline
        labelAlign='right'
        labelWidth={ 15 }
        inputWidth={ 85 }
      />
    </Accordion>
  </Story>
</Preview>

### With a definition list
<Preview>
  <Story name="with a definition list">
    <Accordion title='Heading'>
      <Dl>
        <Dt>Drink</Dt>
        <Dd>Coffee</Dd>
        <Dt>Brew Method</Dt>
        <Dd>Stove Top Moka Pot</Dd>
        <Dt>Brand of Coffee</Dt>
        <Dd>Magic Coffee Beans</Dd>
        <Dt>Website</Dt>
        <Dd><Link href='www.sage.com'>Magic Coffee Beans' Website</Link></Dd>
        <Dt>Email</Dt>
        <Dd><Link href='magic@coffeebeans.com'>magic@coffeebeans.com</Link></Dd>
        <Dt>Main and Registered Address</Dt>
        <Dd mb='4px'>Magic Coffee Beans,</Dd>
        <Dd mb='4px'>In The Middle of Our Street,</Dd>
        <Dd mb='4px'>Madness,</Dd>
        <Dd mb='4px'>CO4 3VE</Dd>
        <Dd>
          <Button 
            buttonType='tertiary' 
            iconType="link" 
            iconPosition="after"
            href='https://goo.gl/maps/GMReLoBpbn9mdZVZ7'
          >
            View in Google Maps
          </Button> 
        </Dd>
      </Dl>
    </Accordion>
  </Story>
</Preview>

<Props of={Accordion} />