import { useState } from 'react';
import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import StyledSystemProps from '../../../.storybook/utils/styled-system-props';

import { AccordionGroup, Accordion } from '.';
import Textbox from '../../__experimental__/components/textbox';
import Button from '../button';
import { Dl, Dt, Dd } from '../definition-list';
import { Checkbox } from '../../__experimental__/components/checkbox';
import Box from '../box';

<Meta
  title="Design System/Accordion"
  parameters={{ info: { disable: true }}}
/>

# Accordion
Group, hide and show content.

## Overview
Accordions are a good progressive disclosure technique - initially showing only top-level information, but allowing the user quick access to more on request. But, they can confuse users sometimes, so use them sparingly.

## Guidance, hints and tips

Don’t put accordions within accordions.

Don’t hide important controls within accordions - for example, primary actions should always be outside them.

Accordions expand and collapse vertically. If there are lots, or content is extensive, be careful that the user doesn’t become confused, lose their place, or have problems with discoverability. Use them sparingly for these reasons.

Accordions should remain open or closed until a user interacts with them. Consider whether multiple, or only one accordion section can be open at a time.

An arrow icon pointing down indicates that the accordion is closed.

An arrow icon pointing up indicates that the accordion is open.

The icon can animate when a transition is made.

The user can click the icon directly, the text label, or the text label’s background to action the accordion.

## Quick Start

To use accordion, import the `Accordion` and pass the content as children.

It can be used as a controlled component where the expansion state is controlled externally,
in that case both `onChange` and `expanded` props are required.

```jsx
import { Accordion } from "carbon-react/lib/components/accordion"

const MyComponent = () => (
  <Accordion onChange={ onChange } expanded={ expanded } title="Title">
    <p>Content as a children</p>
  </Accordion>
);
```

It can also be used as an uncontrolled component where the expansion state is controlled internally.
It is still possible to pass `onChange` to hook a callback for state changes, however to set initial expansion state `defaultExpanded` can be passed.

```jsx
import { Accordion } from "carbon-react/lib/components/accordion"

const MyComponent = () => (
  <Accordion onChange={ onChange } defaultExpanded={ true } title="Title">
    <p>Content as a children</p>
  </Accordion>
);
```

## Visuals

### Default
Default version of accordion has white background and no side borders.
<Preview>
  <Story name="default">
    <Accordion title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### With disableContentPadding
Accordion without padding inside of the content.
<Preview>
  <Story parameters={{ chromatic: { disable: true }}} name="with disableContentPadding">
    <Accordion disableContentPadding title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Transparent
Transparent scheme has transparent background.
<Preview>
  <Story name="transparent" parameters={{ chromatic: { disable: true }}}>
    <Accordion scheme="transparent" title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Small
Small version has a smaller heading and less padding.
<Preview>
  <Story name="small">
    <Accordion size="small" title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Sub title
A sub title can be added when the size is large (default).
<Preview>
  <Story name="sub title">
    <Accordion subTitle='Sub title' title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Full border
The accordion can have side borders along with the default top and bottom.
<Preview>
  <Story name="full border">
    <Accordion borders='full' title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Left aligned icon
The accordion icon can be left aligned.
<Preview>
  <Story name="icon left">
    <Accordion iconAlign='left' title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Different width
The default width of 100% can be overriden.
<Preview>
  <Story name="different width">
    <Accordion width="500px" title='Heading'>
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### With different padding and margin

<Preview>
  <Story name="with different padding and margin">
    <>
      <Accordion m={0} p={0} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion m={1} p={1} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion m={2} p={2} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion m={3} p={3} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion m={4} p={4} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion m={5} p={5} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion m={6} p={6} title="Accordion">
        <div>content</div>
      </Accordion>
    </>
  </Story>
</Preview>

### With different padding and margin in Accordion title

<Preview>
  <Story name="with different padding and margin in Accordion title">
    <>
      <Accordion headerSpacing={{p:0}} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion headerSpacing={{p:1}} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion headerSpacing={{p:2}} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion headerSpacing={{p:3}} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion headerSpacing={{p:4}} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion headerSpacing={{p:5}} title="Accordion">
        <div>content</div>
      </Accordion>
      <Accordion headerSpacing={{p:6}} title="Accordion">
        <div>content</div>
      </Accordion>
    </>
  </Story>
</Preview>

### With Box component and different paddings

<Preview>
  <Story name="with Box component and different paddings" parameters={{ chromatic: { delay: 3500 }}}>
    {() => {
      const [isOpen, setOpen] = useState(true);
      return(
        <>
          <Accordion 
            expanded={isOpen} 
            onClick={() => setOpen(!isOpen)} 
            disableContentPadding 
            headerSpacing={{p:2}} 
            title="Accordion controlled">
            <Box p={2} pr='21px'>
                <Box bg="gray">This is example content inside of the Box component with gray background</Box>
                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
                Nulla in ornare neque. Maecenas pellentesque et erat tincidunt mollis. 
                Etiam diam nisi, elementum efficitur ipsum et, imperdiet iaculis ligula. 
                Cras eget lorem aliquam lorem mollis fringilla a sit amet nisl. 
                Donec semper odio elit, tempus ultrices est molestie id. 
                Ut sit amet sollicitudin ipsum, eu tristique ligula. Praesent velit velit, finibus ut odio sit amet, fringilla iaculis lacus. 
                Aliquam facilisis libero nec ipsum tincidunt imperdiet. Ut commodo mi ac odio blandit, ac molestie ante dapibus. 
                Ut molestie auctor turpis, quis ultrices ante aliquet eu. 
                Aenean et condimentum arcu, non malesuada elit. 
                Cras a magna vestibulum, semper tortor id, molestie eros.
                </div>
            </Box>
          </Accordion>
          <Accordion disableContentPadding headerSpacing={{p:3}} title="Accordion with a very long title Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla in ornare neque. Maecenas pellentesque et erat tincidunt mollis. 
                Etiam diam nisi, elementum efficitur ipsum et, imperdiet iaculis ligula. ">
            <Box p={3} pr='29px'>
              <Box bg="gray">This is example content inside of the Box component with gray background</Box>
                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
                Nulla in ornare neque. Maecenas pellentesque et erat tincidunt mollis. 
                Etiam diam nisi, elementum efficitur ipsum et, imperdiet iaculis ligula. 
                Cras eget lorem aliquam lorem mollis fringilla a sit amet nisl. 
                Donec semper odio elit, tempus ultrices est molestie id. 
                Ut sit amet sollicitudin ipsum, eu tristique ligula. Praesent velit velit, finibus ut odio sit amet, fringilla iaculis lacus. 
                Aliquam facilisis libero nec ipsum tincidunt imperdiet. Ut commodo mi ac odio blandit, ac molestie ante dapibus. 
                Ut molestie auctor turpis, quis ultrices ante aliquet eu. 
                Aenean et condimentum arcu, non malesuada elit. 
                Cras a magna vestibulum, semper tortor id, molestie eros.
                </div>
            </Box>
          </Accordion>
          <Accordion disableContentPadding headerSpacing={{p:4}} title="Accordion">
            <Box p={4} pr='37px'>
              <Box bg="gray">This is example content inside of the Box component with gray background</Box>
                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
                Nulla in ornare neque. Maecenas pellentesque et erat tincidunt mollis. 
                Etiam diam nisi, elementum efficitur ipsum et, imperdiet iaculis ligula. 
                Cras eget lorem aliquam lorem mollis fringilla a sit amet nisl. 
                Donec semper odio elit, tempus ultrices est molestie id. 
                Ut sit amet sollicitudin ipsum, eu tristique ligula. Praesent velit velit, finibus ut odio sit amet, fringilla iaculis lacus. 
                Aliquam facilisis libero nec ipsum tincidunt imperdiet. Ut commodo mi ac odio blandit, ac molestie ante dapibus. 
                Ut molestie auctor turpis, quis ultrices ante aliquet eu. 
                Aenean et condimentum arcu, non malesuada elit. 
                Cras a magna vestibulum, semper tortor id, molestie eros.
                </div>
            </Box>
          </Accordion>
          <Accordion disableContentPadding headerSpacing={{p:5}} title="Accordion">
            <Box p={5} pr="45px">
              <Box bg="gray">This is example content inside of the Box component with gray background</Box>
                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
                Nulla in ornare neque. Maecenas pellentesque et erat tincidunt mollis. 
                Etiam diam nisi, elementum efficitur ipsum et, imperdiet iaculis ligula. 
                Cras eget lorem aliquam lorem mollis fringilla a sit amet nisl. 
                Donec semper odio elit, tempus ultrices est molestie id. 
                Ut sit amet sollicitudin ipsum, eu tristique ligula. Praesent velit velit, finibus ut odio sit amet, fringilla iaculis lacus. 
                Aliquam facilisis libero nec ipsum tincidunt imperdiet. Ut commodo mi ac odio blandit, ac molestie ante dapibus. 
                Ut molestie auctor turpis, quis ultrices ante aliquet eu. 
                Aenean et condimentum arcu, non malesuada elit. 
                Cras a magna vestibulum, semper tortor id, molestie eros.
                </div>
            </Box>
          </Accordion>
        </>
      )
    }}
  </Story>
</Preview>

### Opening button
A button can be passed in to replace the title and opening icon. 
This is not currently designed to be used within a form using validation.
<Preview>
  <Story name="opening button">
    <Accordion
      title="More info"
      openTitle="Less info"
      scheme="transparent"
      borders="none"
      buttonHeading
      buttonWidth={200}
    >
      <div>Content</div>
      <div>Content</div>
      <div>Content</div>
    </Accordion>
  </Story>
</Preview>

### Grouped
Accordions borders collapse when positioned next to each other making it easy to group them.
To achieve proper keyboard accessibility as described in `W3` sources it is required to wrap neighbouring accordions in
`AccordionGroup`.

```jsx
import { Accordion, AccordionGroup } from "carbon-react/lib/components/accordion"
```

<Preview>
  <Story id="design-system-accordion-test--grouped" name="grouped">
  </Story>
</Preview>

### With validation icon
The `ValidationIcon` can be displayed in the `Accordion` header by passing in a string via one of the `error`, 
`warning` or `info` props. This message will be displayed as in the tooltip.

<Preview>
  <Story name="validation icon">
    {() => {
      const [errors, setErrors] = useState({ one: 'error', two: 'error', three: 'error' });
      const [warnings, setWarnings] = useState({});
      const [infos, setInfos] = useState({});
      const [expanded, setExpanded] = useState({one: false, two: false, three: true})
      const handleChange = (id, type, setter, msg) => {
        const update = type[id] ? undefined : msg;
        setter(previous => ({ ...previous, [id]: update }));
      }
      return (
        <div style={{ marginTop: '16px' }}>
          <AccordionGroup>
            <Accordion
              title='Heading'
              expanded={expanded.one}
              onChange={() => setExpanded((previousState) => ({...previousState, one: !previousState.one})) }
              error={errors.one}
              warning={ warnings.one }
              info={ infos.one }>
              <div style={{ padding: '8px'}}>
                <Checkbox
                  label='Add error'
                  error={!!errors.one}
                  onChange={ () => handleChange('one', errors, setErrors, 'error')}
                  checked={!!errors.one}
                />
                <Checkbox
                  label='Add warning'
                  warning={!!warnings.one}
                  onChange={ () => handleChange('one', warnings, setWarnings, 'warning')}
                />
                <Checkbox
                  label='Add info'
                  info={!!infos.one}
                  onChange={ () => handleChange('one', infos, setInfos, 'info')}
                />
              </div>
            </Accordion>
            <Accordion
              title='Heading'
              expanded={expanded.two}
              onChange={() => setExpanded((previousState) => ({...previousState, two: !previousState.two})) }
              subTitle='Sub title'
              error={errors.two}
              warning={ warnings.two }
              info={ infos.two }>
              <div style={{ padding: '8px'}}>
                <Checkbox
                  label='Add error'
                  error={!!errors.two}
                  onChange={ () => handleChange('two', errors, setErrors, 'error')}
                  checked={!!errors.two}
                />
                <Checkbox
                  label='Add warning'
                  warning={!!warnings.two}
                  onChange={ () => handleChange('two', warnings, setWarnings, 'warning')}
                />
                <Checkbox
                  label='Add info'
                  info={!!infos.two}
                  onChange={ () => handleChange('two', infos, setInfos, 'info')}
                />
              </div>
            </Accordion>
            <Accordion
              title='Heading'
              expanded={expanded.three}
              onChange={() => setExpanded((previousState) => ({...previousState, three: !previousState.three})) }
              subTitle='This is a longer sub title'
              error={errors.three}
              warning={ warnings.three }
              info={ infos.three }>
              <div style={{ padding: '8px'}}>
                <Checkbox
                  label='Add error'
                  error={!!errors.three}
                  onChange={ () => handleChange('three', errors, setErrors, 'error')}
                  checked={!!errors.three}
                />
                <Checkbox
                  label='Add warning'
                  warning={!!warnings.three}
                  onChange={ () => handleChange('three', warnings, setWarnings, 'warning')}
                />
                <Checkbox
                  label='Add info'
                  info={!!infos.three}
                  onChange={ () => handleChange('three', infos, setInfos, 'info')}
                />
              </div>
            </Accordion>
          </AccordionGroup>
        </div>
      );
    }}
  </Story>
</Preview>

### With dynamic content
Accordion adjust it's height properly when it's content is being dynamically changed

<Preview>
  <Story name="with dynamic content">
    {() => {
      const [contentCount, setContentCount] = useState(3);
      const modifyContentCount = modifier => {
        if(modifier === 1) {
          setContentCount(contentCount + 1)
        }
        if (modifier === -1 && contentCount > 0) {
          setContentCount(contentCount - 1)
        }
      }
      return (
        <>
          <Button onClick={ () => modifyContentCount(1) }>Add content</Button>
          <Button onClick={ () => modifyContentCount(-1) }>Remove content</Button>
          <Accordion title="Title">
            {Array.from({ length: contentCount }).map((_, index) => <div key={ index }>Content</div>)}
          </Accordion>
        </>
      )
    }}
  </Story>
</Preview>


### With overriden styles
Accordion styles can be easily overriden by providing `styleOverride` prop with proper structure as defined in propTypes.

<Preview>
  <Story name="styles overriden" parameters={{ chromatic: { disable: true }}}>
    <Accordion
      title='Heading'
      styleOverride={
        {
          headerArea: {
            padding: '24px',
            marginLeft: 'calc(15% - 24px)'
          },
          content: { paddingLeft: 0 }
        }
      }
    >
      <Textbox
        label='Label 1'
        labelInline
        labelAlign='right'
        labelWidth={ 15 }
        inputWidth={ 85 }
      />
    </Accordion>
  </Story>
</Preview>

### With a definition list
<Preview>
  <Story name="with a definition list" parameters={{ chromatic: { delay: 3500 }}}>
    <Accordion title='Heading' expanded={true}>
      <Dl>
        <Dt>Drink</Dt>
        <Dd>Coffee</Dd>
        <Dt>Brew Method</Dt>
        <Dd>Stove Top Moka Pot</Dd>
        <Dt>Brand of Coffee</Dt>
        <Dd>Magic Coffee Beans</Dd>
        <Dt>Website</Dt>
        <Dd><Link href='www.sage.com'>Magic Coffee Beans' Website</Link></Dd>
        <Dt>Email</Dt>
        <Dd><Link href='magic@coffeebeans.com'>magic@coffeebeans.com</Link></Dd>
        <Dt>Main and Registered Address</Dt>
        <Dd mb='4px'>Magic Coffee Beans,</Dd>
        <Dd mb='4px'>In The Middle of Our Street,</Dd>
        <Dd mb='4px'>Madness,</Dd>
        <Dd mb='4px'>CO4 3VE</Dd>
        <Dd>
          <Button 
            buttonType='tertiary' 
            iconType="link" 
            iconPosition="after"
            href='https://goo.gl/maps/GMReLoBpbn9mdZVZ7'
          >
            View in Google Maps
          </Button> 
        </Dd>
      </Dl>
    </Accordion>
  </Story>
</Preview>

<Props of={Accordion} />
<StyledSystemProps of={Accordion} spacing />
