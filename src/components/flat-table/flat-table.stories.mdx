import { Meta, Props, Preview, Story } from '@storybook/addon-docs/blocks';
import { useState, useRef } from 'react';
import StyledSystemProps from '../../../.storybook/utils/styled-system-props';
import { 
  FlatTable, 
  FlatTableHead, 
  FlatTableBody, 
  FlatTableRow, 
  FlatTableHeader,
  FlatTableRowHeader,
  FlatTableCell,
  FlatTableCheckbox,
  Sort
} from '.';
import BatchSelection from '../batch-selection';
import IconButton from '../icon-button';
import Icon from '../icon';
import Textbox from '../../__experimental__/components/textbox';
import Pager from '../pager'
import { ActionPopover, ActionPopoverItem, ActionPopoverMenu } from '../action-popover';
import { SidebarContext } from '../drawer';
import Box from '../box';

<Meta title="Design System/Flat Table" parameters={{ info: { disable: true }}} />

# Flat Table
Logically structure content in a grid for the user to enter, view, or work with.

## Contents
- [Quick Start](#quick-start)
- [Examples](#examples)
- [Props](#props)

## Quick Start 
Import all the necessary components from the flat table folder

```javascript 
import { 
  FlatTable, 
  FlatTableHead, 
  FlatTableBody, 
  FlatTableRow, 
  FlatTableHeader,
  FlatTableRowHeader,
  FlatTableCell,
  FlatTableCheckbox,
  Sort
} from 'carbon-react/lib/components/flat-table';
```

## Examples 

### Default

<Preview>
  <Story name="default">
    <FlatTable>
      <FlatTableHead>
        <FlatTableRow>
          <FlatTableHeader>Name</FlatTableHeader>
          <FlatTableHeader>Location</FlatTableHeader>
          <FlatTableHeader>Relationship Status</FlatTableHeader>
          <FlatTableHeader>Dependents</FlatTableHeader>
        </FlatTableRow>
      </FlatTableHead>
      <FlatTableBody>
        <FlatTableRow>
          <FlatTableCell>John Doe</FlatTableCell>
          <FlatTableCell>London</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>0</FlatTableCell>
        </FlatTableRow>
        <FlatTableRow>
          <FlatTableCell>Jane Doe</FlatTableCell>
          <FlatTableCell>York</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>2</FlatTableCell>
        </FlatTableRow>
        <FlatTableRow>
          <FlatTableCell>John Smith</FlatTableCell>
          <FlatTableCell>Edinburgh</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>1</FlatTableCell>
        </FlatTableRow>
        <FlatTableRow>
          <FlatTableCell>Jane Smith</FlatTableCell>
          <FlatTableCell>Newcastle</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>5</FlatTableCell>
        </FlatTableRow>
      </FlatTableBody>
    </FlatTable>
  </Story>
</Preview>

### With row headers
Any cells preceding the `FlatTableRowHeader`s will automatically also be made sticky as seen in the example below.

<Preview>
  <Story name="with row header" parameters={{ chromatic: { disable: true }}}>
    <div style={ { width: '380px', overflowX: 'auto' } }>
      <FlatTable>
        <FlatTableHead>
          <FlatTableRow>
            <FlatTableHeader>ID Number</FlatTableHeader>
            <FlatTableRowHeader>Name</FlatTableRowHeader>
            <FlatTableHeader>Location</FlatTableHeader>
            <FlatTableHeader>Relationship Status</FlatTableHeader>
            <FlatTableHeader>Dependents</FlatTableHeader>
          </FlatTableRow>
        </FlatTableHead>
        <FlatTableBody>
          <FlatTableRow>
            <FlatTableCell>000001</FlatTableCell>
            <FlatTableRowHeader>John Doe</FlatTableRowHeader>
            <FlatTableCell>London</FlatTableCell>
            <FlatTableCell>Single</FlatTableCell>
            <FlatTableCell>0</FlatTableCell>
          </FlatTableRow>
          <FlatTableRow>
            <FlatTableCell>000002</FlatTableCell>
            <FlatTableRowHeader>Jane Doe</FlatTableRowHeader>
            <FlatTableCell>York</FlatTableCell>
            <FlatTableCell>Married</FlatTableCell>
            <FlatTableCell>2</FlatTableCell>
          </FlatTableRow>
          <FlatTableRow>
            <FlatTableCell>000003</FlatTableCell>
            <FlatTableRowHeader>John Smith</FlatTableRowHeader>
            <FlatTableCell>Edinburgh</FlatTableCell>
            <FlatTableCell>Single</FlatTableCell>
            <FlatTableCell>1</FlatTableCell>
          </FlatTableRow>
          <FlatTableRow>
            <FlatTableCell>000004</FlatTableCell>
            <FlatTableRowHeader>Jane Smith</FlatTableRowHeader>
            <FlatTableCell>Newcastle</FlatTableCell>
            <FlatTableCell>Married</FlatTableCell>
            <FlatTableCell>5</FlatTableCell>
          </FlatTableRow>
        </FlatTableBody>
      </FlatTable>
    </div>
  </Story>
</Preview>

### With custom cell paddings
Padding can be set on each cell individually by using the spacing props syntax. Check prop tables at the bottom of this document for more information.

<Preview>
  <Story name="with custom cell paddings">
    <FlatTable>
      <FlatTableHead>
        <FlatTableRow>
          <FlatTableHeader px={5} py={2}>Name</FlatTableHeader>
          <FlatTableHeader py={2}>Location</FlatTableHeader>
          <FlatTableHeader py={2}>Relationship Status</FlatTableHeader>
          <FlatTableHeader py={2}>Dependents</FlatTableHeader>
        </FlatTableRow>
      </FlatTableHead>
      <FlatTableBody>
        {[1,2,3,4].map((key) => 
          <FlatTableRow key={key}>
            <FlatTableCell px={5}>John Doe</FlatTableCell>
            <FlatTableCell>London</FlatTableCell>
            <FlatTableCell>Single</FlatTableCell>
            <FlatTableCell>5</FlatTableCell>
          </FlatTableRow>
        )}
      </FlatTableBody>
    </FlatTable>
  </Story>
</Preview>

### With custom column width
Column width can be set by passing number as a `width` prop to the column header component.
**Column width can't be smaller than the sum of horizontal cell padding and content width.**

<Preview>
  <Story name="with custom column width">
    <FlatTable>
      <FlatTableHead>
        <FlatTableRow>
          <FlatTableHeader>Name</FlatTableHeader>
          <FlatTableHeader>Location</FlatTableHeader>
          <FlatTableHeader width={200}>Notes</FlatTableHeader>
          <FlatTableHeader width={40} px={1}>
            <Icon iconColor="on-dark-background" type="settings"/>
          </FlatTableHeader>
        </FlatTableRow>
      </FlatTableHead>
      <FlatTableBody>
        {[1,2,3,4].map((key) => 
          <FlatTableRow key={key}>
            <FlatTableCell>John Doe</FlatTableCell>
            <FlatTableCell>London</FlatTableCell>
            <FlatTableCell><Textbox size="small"/></FlatTableCell>
            <FlatTableCell px={1}>
              <ActionPopover>
                <ActionPopoverItem onClick={() => {}} icon='graph'>Business</ActionPopoverItem>
                <ActionPopoverItem onClick={() => {}} icon='email'>Email Invoice</ActionPopoverItem>
              </ActionPopover>
            </FlatTableCell>
          </FlatTableRow>
        )}
      </FlatTableBody>
    </FlatTable>
  </Story>
</Preview>

### With stickyHead prop set to true

<Preview>
  <Story name="with sticky head" parameters={{ chromatic: { disable: true }}}>
    <div style={ { height: '150px' } }>
      <FlatTable hasStickyHead>
        <FlatTableHead>
          <FlatTableRow>
            <FlatTableHeader>Name</FlatTableHeader>
            <FlatTableHeader>Location</FlatTableHeader>
            <FlatTableHeader>Relationship Status</FlatTableHeader>
            <FlatTableHeader>Dependents</FlatTableHeader>
          </FlatTableRow>
        </FlatTableHead>
        <FlatTableBody>
          <FlatTableRow>
            <FlatTableCell>John Doe</FlatTableCell>
            <FlatTableCell>London</FlatTableCell>
            <FlatTableCell>Single</FlatTableCell>
            <FlatTableCell>0</FlatTableCell>
          </FlatTableRow>
          <FlatTableRow>
            <FlatTableCell>Jane Doe</FlatTableCell>
            <FlatTableCell>York</FlatTableCell>
            <FlatTableCell>Married</FlatTableCell>
            <FlatTableCell>2</FlatTableCell>
          </FlatTableRow>
          <FlatTableRow>
            <FlatTableCell>John Smith</FlatTableCell>
            <FlatTableCell>Edinburgh</FlatTableCell>
            <FlatTableCell>Single</FlatTableCell>
            <FlatTableCell>1</FlatTableCell>
          </FlatTableRow>
          <FlatTableRow>
            <FlatTableCell>Jane Smith</FlatTableCell>
            <FlatTableCell>Newcastle</FlatTableCell>
            <FlatTableCell>Married</FlatTableCell>
            <FlatTableCell>5</FlatTableCell>
          </FlatTableRow>
        </FlatTableBody>
      </FlatTable>
    </div>
  </Story>
</Preview>

### With stickyFooter prop set to true

<Preview>
  <Story name="with sticky footer" parameters={{ chromatic: { disable: true }}}>
    {() => {
      const rows = [
        <FlatTableRow key='0'>
          <FlatTableCell>John Doe</FlatTableCell>
          <FlatTableCell>London</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>0</FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='1'>
          <FlatTableCell>Jane Doe</FlatTableCell>
          <FlatTableCell>York</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>2</FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='2'>
          <FlatTableCell>John Smith</FlatTableCell>
          <FlatTableCell>Edinburgh</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>1</FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='3'>
          <FlatTableCell>Jane Smith</FlatTableCell>
          <FlatTableCell>Newcastle</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>5</FlatTableCell>
        </FlatTableRow>,
       <FlatTableRow key='4'>
          <FlatTableCell>Liz Anya</FlatTableCell>
          <FlatTableCell>Stoke</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>2</FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='5'>
          <FlatTableCell>Karl Ickbred</FlatTableCell>
          <FlatTableCell>Newcastle</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>0</FlatTableCell>
        </FlatTableRow>
      ];
      const [recordsRange, setRecordsRange] = useState({ start: 0, end: 5 });
      const [currentPage, setCurrentPage] = useState(1);
      const renderRows = () => {
        const { start, end } = recordsRange;
        if (start < 0) return rows;
        if (end > rows.length) return rows.slice(start, rows.length);
        return rows.slice(start, end);
      };
      const handlePagination = (newPage, newPageSize) => {
        const start = (newPage - 1) * newPageSize;
        const end = start + newPageSize;
        setRecordsRange({ start, end });
        setCurrentPage(newPage);
      };
      return (
        <div style={ { height: "180px", marginBottom: "16px" } }>
          <FlatTable hasStickyHead hasStickyFooter footer={
            <Pager
              totalRecords={ rows.length }
              showPageSizeSelection
              pageSize={ 5 }
              currentPage={ currentPage }
              onPagination={ (next, size) => handlePagination(next, size) }
              pageSizeSelectionOptions={ 
                [
                  { id: '1', name: 1 },
                  { id: '5', name: 5 },
                ]}
            />
          }>
            <FlatTableHead>
              <FlatTableRow>
                <FlatTableHeader>Name</FlatTableHeader>
                <FlatTableHeader>Location</FlatTableHeader>
                <FlatTableHeader>Relationship Status</FlatTableHeader>
                <FlatTableHeader>Dependents</FlatTableHeader>
              </FlatTableRow>
            </FlatTableHead>
            <FlatTableBody>
              { renderRows() }
            </FlatTableBody>
          </FlatTable>
        </div>
      );
    }} 
  </Story>
</Preview>

### With clickable rows

<Preview>
  <Story name="with clickable rows" parameters={{ chromatic: { disable: true }}}>
    <FlatTable>
      <FlatTableHead>
        <FlatTableRow>
          <FlatTableHeader>Name</FlatTableHeader>
          <FlatTableHeader>Location</FlatTableHeader>
          <FlatTableHeader>Relationship Status</FlatTableHeader>
          <FlatTableHeader>Dependents</FlatTableHeader>
        </FlatTableRow>
      </FlatTableHead>
      <FlatTableBody>
        <FlatTableRow onClick={ () => {} }>
          <FlatTableCell>John Doe</FlatTableCell>
          <FlatTableCell>London</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>0</FlatTableCell>
        </FlatTableRow>
        <FlatTableRow onClick={ () => {} }>
          <FlatTableCell>Jane Doe</FlatTableCell>
          <FlatTableCell>York</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>2</FlatTableCell>
        </FlatTableRow>
        <FlatTableRow onClick={ () => {} }>
          <FlatTableCell>John Smith</FlatTableCell>
          <FlatTableCell>Edinburgh</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>1</FlatTableCell>
        </FlatTableRow>
        <FlatTableRow onClick={ () => {} }>
          <FlatTableCell>Jane Smith</FlatTableCell>
          <FlatTableCell>Newcastle</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>5</FlatTableCell>
        </FlatTableRow>
      </FlatTableBody>
    </FlatTable>
  </Story>
</Preview>

### With zebra stripes

<Preview>
  <Story name="zebra">
    <FlatTable isZebra>
      <FlatTableHead>
        <FlatTableRow>
          <FlatTableHeader>Name</FlatTableHeader>
          <FlatTableHeader>Location</FlatTableHeader>
          <FlatTableHeader>Relationship Status</FlatTableHeader>
          <FlatTableHeader>Dependents</FlatTableHeader>
        </FlatTableRow>
      </FlatTableHead>
      <FlatTableBody>
        <FlatTableRow>
          <FlatTableCell>John Doe</FlatTableCell>
          <FlatTableCell>London</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>0</FlatTableCell>
        </FlatTableRow>
          <FlatTableRow>
          <FlatTableCell>Jane Doe</FlatTableCell>
          <FlatTableCell>York</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>2</FlatTableCell>
        </FlatTableRow>
          <FlatTableRow>
          <FlatTableCell>John Smith</FlatTableCell>
          <FlatTableCell>Edinburgh</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>1</FlatTableCell>
        </FlatTableRow>
        <FlatTableRow>
          <FlatTableCell>Jane Smith</FlatTableCell>
          <FlatTableCell>Newcastle</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>5</FlatTableCell>
        </FlatTableRow>
      </FlatTableBody>
    </FlatTable>
  </Story>
</Preview>

### With sorting headers

<Preview>
  <Story id="design-system-flat-table-test--sortable" name="with sorting headers" />
</Preview>

### With a cell spanning the whole row 

<Preview>
  <Story name="with colspan">
      <FlatTable>
        <FlatTableHead>
          <FlatTableRow>
            <FlatTableHeader>Name</FlatTableHeader>
            <FlatTableHeader>Location</FlatTableHeader>
            <FlatTableHeader>Relationship Status</FlatTableHeader>
            <FlatTableHeader>Dependents</FlatTableHeader>
          </FlatTableRow>
        </FlatTableHead>
        <FlatTableBody>
          <FlatTableRow>
            <FlatTableCell colspan='4' align='center'>No results</FlatTableCell>
          </FlatTableRow>
        </FlatTableBody>
      </FlatTable>
  </Story>
</Preview>

### With a cell spanning the whole column

<Preview>
  <Story name="with rowspan">
      <FlatTable>
        <FlatTableHead>
          <FlatTableRow>
            <FlatTableHeader>Parent Name</FlatTableHeader>
            <FlatTableHeader>Child Name</FlatTableHeader>
            <FlatTableHeader>Child Age</FlatTableHeader>
          </FlatTableRow>
        </FlatTableHead>
        <FlatTableBody>
          <FlatTableRow>
            <FlatTableCell rowspan='3'>Jane Smith</FlatTableCell>
            <FlatTableCell>Tim Smith</FlatTableCell>
            <FlatTableCell>8</FlatTableCell>
          </FlatTableRow>
          <FlatTableRow>
            <FlatTableCell>Chris Smith</FlatTableCell>
            <FlatTableCell>8</FlatTableCell>
          </FlatTableRow>
          <FlatTableRow>
            <FlatTableCell>Alice Smith</FlatTableCell>
            <FlatTableCell>12</FlatTableCell>
          </FlatTableRow>
        </FlatTableBody>
      </FlatTable>
  </Story>
</Preview>

### With Selectable Rows
It is possible to use the selected prop on the FlatTableRow to handle the selection of multiple rows of data.

To take an action across multiple table rows, the user can first select relevant rows with their checkboxes, then apply an action at the top left of the table.

If a given action isnâ€™t available for a single selected item, the option appears disabled. A tooltip may explain why.

If a given action is available for some, but not all, selected rows, then the action is performed, but the user is notified.

Where icons are used for batch actions, they have text labels too, or tooltips to make their function clear. There are always confirmation dialogs for destructive actions, or those difficult to undo.

<Preview>
  <Story name="selectable rows" parameters={{ chromatic: { disable: true }}}>
    {() => {
      const [selectAll, setSelectAll] = useState(false);
      const [selectedRows, setSelectedRows] = useState({ one: false, two: false, three: false, four: false });
      const handleSelectAllRows = () => {
        const newState = {};
        Object.keys(selectedRows).forEach((key) => newState[key] = !selectAll);
        setSelectedRows({ ...newState });
        setSelectAll(!selectAll);
      };
      const handleSelectRow = (id) => {
        if (selectedRows[id]) {
          setSelectAll(false);
        }
        setSelectedRows({ ...selectedRows, [id]: !selectedRows[id] });
      };
      const selectedCount = Object.keys(selectedRows).filter(key => Boolean(selectedRows[key])).length;
      return (
        <>
          <BatchSelection disabled={ selectedCount === 0 } selectedCount={ selectedCount }>
            <IconButton onAction={ () => {} }><Icon type='csv' /></IconButton>
            <IconButton onAction={ () => {} }><Icon type='bin' /></IconButton>
            <IconButton onAction={ () => {} }><Icon type='pdf' /></IconButton>
          </BatchSelection>
          <FlatTable>
            <FlatTableHead>
              <FlatTableRow>
                <FlatTableCheckbox
                  as='th'
                  checked={ selectAll }
                  onChange={ () => handleSelectAllRows() }
                />
                <FlatTableHeader>Name</FlatTableHeader>
                <FlatTableHeader>Location</FlatTableHeader>
                <FlatTableHeader>Relationship Status</FlatTableHeader>
                <FlatTableHeader>Dependents</FlatTableHeader>
              </FlatTableRow>
            </FlatTableHead>
            <FlatTableBody>
              <FlatTableRow selected={ selectedRows.one }>
                <FlatTableCheckbox checked={ selectedRows.one } onChange={ () => handleSelectRow('one')} />
                <FlatTableCell>John Doe</FlatTableCell>
                <FlatTableCell>London</FlatTableCell>
                <FlatTableCell>Single</FlatTableCell>
                <FlatTableCell>0</FlatTableCell>
              </FlatTableRow>
              <FlatTableRow selected={ selectedRows.two }>
                <FlatTableCheckbox checked={ selectedRows.two } onChange={ () => handleSelectRow('two')} />
                <FlatTableCell>Jane Doe</FlatTableCell>
                <FlatTableCell>York</FlatTableCell>
                <FlatTableCell>Married</FlatTableCell>
                <FlatTableCell>2</FlatTableCell>
              </FlatTableRow>
              <FlatTableRow selected={ selectedRows.three }>
                <FlatTableCheckbox checked={ selectedRows.three } onChange={ () => handleSelectRow('three')} />
                <FlatTableCell>John Smith</FlatTableCell>
                <FlatTableCell>Edinburgh</FlatTableCell>
                <FlatTableCell>Single</FlatTableCell>
                <FlatTableCell>1</FlatTableCell>
              </FlatTableRow>
              <FlatTableRow selected={ selectedRows.four }>
                <FlatTableCheckbox checked={ selectedRows.four } onChange={ () => handleSelectRow('four')} />
                <FlatTableCell>Jane Smith</FlatTableCell>
                <FlatTableCell>Newcastle</FlatTableCell>
                <FlatTableCell>Married</FlatTableCell>
                <FlatTableCell>5</FlatTableCell>
              </FlatTableRow>
            </FlatTableBody>
          </FlatTable>
        </>
      );
    }} 
  </Story>
</Preview>

### With Highlightable Rows
It is possible to utilise the selected and onClick props on the FlatTableRow to highlight single rows of data.

<Preview>
  <Story name="highlightable rows" parameters={{ chromatic: { disable: true }}}>
    {() => {
      const [highlightedRow, setHighlightedRow] = useState('');
      const handleHighlightRow = (id) => {
        if (highlightedRow === id) {
          setHighlightedRow('')
        } else {
          setHighlightedRow(id);
        }
      }
      return (
        <FlatTable>
          <FlatTableHead>
            <FlatTableRow>
              <FlatTableHeader>Name</FlatTableHeader>
              <FlatTableHeader>Location</FlatTableHeader>
              <FlatTableHeader>Relationship Status</FlatTableHeader>
              <FlatTableHeader>Dependents</FlatTableHeader>
            </FlatTableRow>
          </FlatTableHead>
          <FlatTableBody>
            <FlatTableRow onClick={ () => handleHighlightRow('one') } highlighted={ highlightedRow === 'one' }>
              <FlatTableCell>John Doe</FlatTableCell>
              <FlatTableCell>London</FlatTableCell>
              <FlatTableCell>Single</FlatTableCell>
              <FlatTableCell>0</FlatTableCell>
            </FlatTableRow>
            <FlatTableRow onClick={ () => handleHighlightRow('two') } highlighted={ highlightedRow === 'two' }>
              <FlatTableCell>Jane Doe</FlatTableCell>
              <FlatTableCell>York</FlatTableCell>
              <FlatTableCell>Married</FlatTableCell>
              <FlatTableCell>2</FlatTableCell>
            </FlatTableRow>
            <FlatTableRow onClick={ () => handleHighlightRow('three') }highlighted={ highlightedRow === 'three' }>
              <FlatTableCell>John Smith</FlatTableCell>
              <FlatTableCell>Edinburgh</FlatTableCell>
              <FlatTableCell>Single</FlatTableCell>
              <FlatTableCell>1</FlatTableCell>
            </FlatTableRow>
            <FlatTableRow onClick={ () => handleHighlightRow('four') } highlighted={ highlightedRow === 'four' }>
              <FlatTableCell>Jane Smith</FlatTableCell>
              <FlatTableCell>Newcastle</FlatTableCell>
              <FlatTableCell>Married</FlatTableCell>
              <FlatTableCell>5</FlatTableCell>
            </FlatTableRow>
          </FlatTableBody>
        </FlatTable>
      );
    }} 
  </Story>
</Preview>

### With Selectable and Highlightable Rows
It is also possible to integrate selection of multiple rows and the highlighting of single rows.

<Preview>
  <Story name="selectable and highlightable rows" parameters={{ chromatic: { disable: true }}}>
    {() => {
      const [selectAll, setSelectAll] = useState(false);
      const [selectedRows, setSelectedRows] = useState({ one: false, two: false, three: false, four: false });
      const [highlightedRow, setHighlightedRow] = useState('');
      const handleSelectAllRows = () => {
        const newState = {};
        Object.keys(selectedRows).forEach((key) => newState[key] = !selectAll);
        setSelectedRows({ ...newState });
        setSelectAll(!selectAll);
      };
      const handleSelectRow = (id) => {
        if (selectedRows[id]) {
          setSelectAll(false);
        }
        setSelectedRows({ ...selectedRows, [id]: !selectedRows[id] });
      };
      const selectedCount = Object.keys(selectedRows).filter(key => Boolean(selectedRows[key])).length;
      const handleHighlightRow = (id) => {
        if (highlightedRow === id) {
          setHighlightedRow('')
        } else {
          setHighlightedRow(id);
        }
      }
      return (
        <>
          <BatchSelection disabled={ selectedCount === 0 } selectedCount={ selectedCount }>
            <IconButton onAction={ () => {} }><Icon type='csv' /></IconButton>
            <IconButton onAction={ () => {} }><Icon type='bin' /></IconButton>
            <IconButton onAction={ () => {} }><Icon type='pdf' /></IconButton>
          </BatchSelection>
          <FlatTable>
            <FlatTableHead>
              <FlatTableRow>
                <FlatTableCheckbox
                  as='th'
                  checked={ selectAll }
                  onChange={ () => handleSelectAllRows() }
                />
                <FlatTableHeader>Name</FlatTableHeader>
                <FlatTableHeader>Location</FlatTableHeader>
                <FlatTableHeader>Relationship Status</FlatTableHeader>
                <FlatTableHeader>Dependents</FlatTableHeader>
              </FlatTableRow>
            </FlatTableHead>
            <FlatTableBody>
              <FlatTableRow onClick={() => handleHighlightRow('one') } selected={ selectedRows.one } highlighted={ highlightedRow === 'one' }>
                <FlatTableCheckbox checked={ selectedRows.one } onChange={ () => handleSelectRow('one')} />
                <FlatTableCell>John Doe</FlatTableCell>
                <FlatTableCell>London</FlatTableCell>
                <FlatTableCell>Single</FlatTableCell>
                <FlatTableCell>0</FlatTableCell>
              </FlatTableRow>
              <FlatTableRow onClick={() => handleHighlightRow('two') } selected={ selectedRows.two } highlighted={ highlightedRow === 'two' }>
                <FlatTableCheckbox checked={ selectedRows.two } onChange={ () => handleSelectRow('two')} />
                <FlatTableCell>Jane Doe</FlatTableCell>
                <FlatTableCell>York</FlatTableCell>
                <FlatTableCell>Married</FlatTableCell>
                <FlatTableCell>2</FlatTableCell>
              </FlatTableRow>
              <FlatTableRow onClick={() => handleHighlightRow('three') } selected={ selectedRows.three } highlighted={ highlightedRow === 'three' }>
                <FlatTableCheckbox checked={ selectedRows.three } onChange={ () => handleSelectRow('three')} />
                <FlatTableCell>John Smith</FlatTableCell>
                <FlatTableCell>Edinburgh</FlatTableCell>
                <FlatTableCell>Single</FlatTableCell>
                <FlatTableCell>1</FlatTableCell>
              </FlatTableRow>
              <FlatTableRow onClick={() => handleHighlightRow('four') } selected={ selectedRows.four } highlighted={ highlightedRow === 'four' }>
                <FlatTableCheckbox checked={ selectedRows.four } onChange={ () => handleSelectRow('four')} />
                <FlatTableCell>Jane Smith</FlatTableCell>
                <FlatTableCell>Newcastle</FlatTableCell>
                <FlatTableCell>Married</FlatTableCell>
                <FlatTableCell>5</FlatTableCell>
              </FlatTableRow>
            </FlatTableBody>
          </FlatTable>
        </>
      );
    }} 
  </Story>
</Preview>

### With Pagination
If pagination is needed, this can be shown at the bottom of the table.

Balance performance concerns with the convenience of the user being able to see more data - we suggest giving the user the option of showing 25, 50, and 100 table rows before pagination, with a default of 50. Whatever the user selects, make this sticky per user, per table, and between sessions.

<Preview>
  <Story name="paginated">
    {() => {
      const rows = [
        <FlatTableRow key='0'>
          <FlatTableCell>John Doe</FlatTableCell>
          <FlatTableCell>London</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>0</FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='1'>
          <FlatTableCell>Jane Doe</FlatTableCell>
          <FlatTableCell>York</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>2</FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='2'>
          <FlatTableCell>John Smith</FlatTableCell>
          <FlatTableCell>Edinburgh</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>1</FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='3'>
          <FlatTableCell>Jane Smith</FlatTableCell>
          <FlatTableCell>Newcastle</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>5</FlatTableCell>
        </FlatTableRow>,
       <FlatTableRow key='4'>
          <FlatTableCell>Liz Anya</FlatTableCell>
          <FlatTableCell>Stoke</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>2</FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='5'>
          <FlatTableCell>Karl Ickbred</FlatTableCell>
          <FlatTableCell>Newcastle</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>0</FlatTableCell>
        </FlatTableRow>
      ];
      const [recordsRange, setRecordsRange] = useState({ start: 0, end: 5 });
      const [currentPage, setCurrentPage] = useState(1);
      const renderRows = () => {
        const { start, end } = recordsRange;
        if (start < 0) return rows;
        if (end > rows.length) return rows.slice(start, rows.length);
        return rows.slice(start, end);
      };
      const handlePagination = (newPage, newPageSize) => {
        const start = (newPage - 1) * newPageSize;
        const end = start + newPageSize;
        setRecordsRange({ start, end });
        setCurrentPage(newPage);
      };
      return (
        <>
          <FlatTable footer={
            <Pager
              totalRecords={ rows.length }
              showPageSizeSelection
              pageSize={ 5 }
              currentPage={ currentPage }
              onPagination={ (next, size) => handlePagination(next, size) }
              pageSizeSelectionOptions={ 
                [
                  { id: '1', name: 1 },
                  { id: '5', name: 5 },
                ]}
            />
          }>
            <FlatTableHead>
              <FlatTableRow>
                <FlatTableHeader>Name</FlatTableHeader>
                <FlatTableHeader>Location</FlatTableHeader>
                <FlatTableHeader>Relationship Status</FlatTableHeader>
                <FlatTableHeader>Dependents</FlatTableHeader>
              </FlatTableRow>
            </FlatTableHead>
            <FlatTableBody>
              { renderRows() }
            </FlatTableBody>
          </FlatTable>
        </>
      );
    }} 
  </Story>
</Preview>

### Paginated with sticky header
When using the `Pager` and a sticky `FlatTableHead` some of the child elements may have style properties that cause the 
overflow to exceed the height of the table. In the example below, the `ActionPopoverMenu` has absolute positioning meaning 
it is accounted for in the overflow. To avoid this it is possible to use the `placement` prop to render the menu on `top` 
of the button control.

<Preview>
  <Story name="paginated with sticky header" parameters={{ info: { disable: true }}} >
    {() => {
      const [placementUp, setPlacementUp] = useState(true);
      const rows = [
        <FlatTableRow key='0'>
          <FlatTableCell>John Doe</FlatTableCell>
          <FlatTableCell>London</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>
            <ActionPopover>
              <ActionPopoverItem onClick={() => {}}>
                action
              </ActionPopoverItem>
            </ActionPopover>
          </FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='1'>
          <FlatTableCell>Jane Doe</FlatTableCell>
          <FlatTableCell>York</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>
            <ActionPopover>
              <ActionPopoverItem onClick={() => {}} submenu={
                <ActionPopoverMenu>
                  <ActionPopoverItem onClick={() => {}}>
                    CSV
                  </ActionPopoverItem>
                  <ActionPopoverItem onClick={() => {}}>
                    PDF
                  </ActionPopoverItem>
                </ActionPopoverMenu>}
              >
                action
              </ActionPopoverItem>
            </ActionPopover>
          </FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='2'>
          <FlatTableCell>John Smith</FlatTableCell>
          <FlatTableCell>Edinburgh</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>
            <ActionPopover>
              <ActionPopoverItem onClick={() => {}}>
                action
              </ActionPopoverItem>
            </ActionPopover>
          </FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='3'>
          <FlatTableCell>Jane Smith</FlatTableCell>
          <FlatTableCell>Newcastle</FlatTableCell>
          <FlatTableCell>Married</FlatTableCell>
          <FlatTableCell>
            <ActionPopover placement={placementUp ? "top" : "bottom"}>
              <ActionPopoverItem onClick={() => {}}>
                action
              </ActionPopoverItem>
            </ActionPopover>
          </FlatTableCell>
        </FlatTableRow>,
       <FlatTableRow key='4'>
          <FlatTableCell>Liz Anya</FlatTableCell>
          <FlatTableCell>Stoke</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>
            <ActionPopover placement={placementUp ? "top" : "bottom"}>
              <ActionPopoverItem onClick={() => {}} submenu={
                <ActionPopoverMenu>
                  <ActionPopoverItem onClick={() => {}}>
                    CSV
                  </ActionPopoverItem>
                  <ActionPopoverItem onClick={() => {}}>
                    PDF
                  </ActionPopoverItem>
                </ActionPopoverMenu>
              }
              >
                action
              </ActionPopoverItem>
              <ActionPopoverItem onClick={() => {}} submenu={
                <ActionPopoverMenu>
                  <ActionPopoverItem onClick={() => {}}>
                    CSV
                  </ActionPopoverItem>
                  <ActionPopoverItem onClick={() => {}}>
                    PDF
                  </ActionPopoverItem>
                </ActionPopoverMenu>}
              >
                action
              </ActionPopoverItem>
            </ActionPopover>
          </FlatTableCell>
        </FlatTableRow>,
        <FlatTableRow key='5'>
          <FlatTableCell>Karl Ickbred</FlatTableCell>
          <FlatTableCell>Newcastle</FlatTableCell>
          <FlatTableCell>Single</FlatTableCell>
          <FlatTableCell>
            <ActionPopover>
              <ActionPopoverItem onClick={() => {}} submenu={
                <ActionPopoverMenu>
                  <ActionPopoverItem onClick={() => {}}>
                    CSV
                  </ActionPopoverItem>
                  <ActionPopoverItem onClick={() => {}}>
                    PDF
                  </ActionPopoverItem>
                </ActionPopoverMenu>}
              >
                action
              </ActionPopoverItem>
              <ActionPopoverItem onClick={() => {}} submenu={
                <ActionPopoverMenu>
                  <ActionPopoverItem onClick={() => {}}>
                    CSV
                  </ActionPopoverItem>
                  <ActionPopoverItem onClick={() => {}}>
                    PDF
                  </ActionPopoverItem>
                </ActionPopoverMenu>
              }
              >
                action
              </ActionPopoverItem>
            </ActionPopover>
          </FlatTableCell>
        </FlatTableRow>
      ];
      const [recordsRange, setRecordsRange] = useState({ start: 0, end: 5 });
      const [currentPage, setCurrentPage] = useState(1);
      const renderRows = () => {
        const { start, end } = recordsRange;
        if (start < 0) return rows;
        if (end > rows.length) return rows.slice(start, rows.length);
        return rows.slice(start, end);
      };
      const handlePagination = (newPage, newPageSize) => {
        const start = (newPage - 1) * newPageSize;
        const end = start + newPageSize;
        setPlacementUp(newPageSize !== 1);
        setRecordsRange({ start, end });
        setCurrentPage(newPage);
      };
      return (
        <div style={{ height: '200px' }}>
          <FlatTable
            hasStickyHead
            hasStickyFooter
            footer={
              <Pager
                totalRecords={ rows.length }
                showPageSizeSelection
                pageSize={ 5 }
                currentPage={ currentPage }
                onPagination={ (next, size) => handlePagination(next, size) }
                pageSizeSelectionOptions={ 
                  [
                    { id: '1', name: 1 },
                    { id: '5', name: 5 },
                  ]}
              />
            }>
            <FlatTableHead>
              <FlatTableRow>
                <FlatTableHeader>Name</FlatTableHeader>
                <FlatTableHeader>Location</FlatTableHeader>
                <FlatTableHeader>Relationship Status</FlatTableHeader>
                <FlatTableHeader>Dependents</FlatTableHeader>
              </FlatTableRow>
            </FlatTableHead>
            <FlatTableBody>
              { renderRows() }
            </FlatTableBody>
          </FlatTable>
        </div>
      );
    }} 
  </Story>
</Preview>

### When a child of Sidebar

<Preview>
  <Story name="when a child of sidebar" parameters={{ chromatic: { disable: true }}}>
    {() => {
      const [selectAll, setSelectAll] = useState(false);
      const [selectedRows, setSelectedRows] = useState({ one: false, two: false, three: false, four: false });
      const [highlightedRow, setHighlightedRow] = useState('');
      const handleSelectAllRows = () => {
        const newState = {};
        Object.keys(selectedRows).forEach((key) => newState[key] = !selectAll);
        setSelectedRows({ ...newState });
        setSelectAll(!selectAll);
      };
      const handleSelectRow = (id) => {
        if (selectedRows[id]) {
          setSelectAll(false);
        }
        setSelectedRows({ ...selectedRows, [id]: !selectedRows[id] });
      };
      const selectedCount = Object.keys(selectedRows).filter(key => Boolean(selectedRows[key])).length;
      const handleHighlightRow = (id) => {
        if (highlightedRow === id) {
          setHighlightedRow('')
        } else {
          setHighlightedRow(id);
        }
      }
      return (
        <>
          <BatchSelection disabled={ selectedCount === 0 } selectedCount={ selectedCount }>
            <IconButton onAction={ () => {} }><Icon type='csv' /></IconButton>
            <IconButton onAction={ () => {} }><Icon type='bin' /></IconButton>
            <IconButton onAction={ () => {} }><Icon type='pdf' /></IconButton>
          </BatchSelection>
          <SidebarContext.Provider value={{isInSidebar: true}}>
            <FlatTable>
              <FlatTableHead>
                <FlatTableRow>
                  <FlatTableCheckbox
                    as='th'
                    checked={ selectAll }
                    onChange={ () => handleSelectAllRows() }
                  />
                  <FlatTableHeader>Name</FlatTableHeader>
                  <FlatTableHeader>Location</FlatTableHeader>
                  <FlatTableHeader>Relationship Status</FlatTableHeader>
                  <FlatTableHeader>Dependents</FlatTableHeader>
                </FlatTableRow>
              </FlatTableHead>
              <FlatTableBody>
                <FlatTableRow onClick={() => handleHighlightRow('one') } selected={ selectedRows.one } highlighted={ highlightedRow === 'one' }>
                  <FlatTableCheckbox checked={ selectedRows.one } onChange={ () => handleSelectRow('one')} />
                  <FlatTableCell>John Doe</FlatTableCell>
                  <FlatTableCell>London</FlatTableCell>
                  <FlatTableCell>Single</FlatTableCell>
                  <FlatTableCell>0</FlatTableCell>
                </FlatTableRow>
                <FlatTableRow onClick={() => handleHighlightRow('two') } selected={ selectedRows.two } highlighted={ highlightedRow === 'two' }>
                  <FlatTableCheckbox checked={ selectedRows.two } onChange={ () => handleSelectRow('two')} />
                  <FlatTableCell>Jane Doe</FlatTableCell>
                  <FlatTableCell>York</FlatTableCell>
                  <FlatTableCell>Married</FlatTableCell>
                  <FlatTableCell>2</FlatTableCell>
                </FlatTableRow>
                <FlatTableRow onClick={() => handleHighlightRow('three') } selected={ selectedRows.three } highlighted={ highlightedRow === 'three' }>
                  <FlatTableCheckbox checked={ selectedRows.three } onChange={ () => handleSelectRow('three')} />
                  <FlatTableCell>John Smith</FlatTableCell>
                  <FlatTableCell>Edinburgh</FlatTableCell>
                  <FlatTableCell>Single</FlatTableCell>
                  <FlatTableCell>1</FlatTableCell>
                </FlatTableRow>
                <FlatTableRow onClick={() => handleHighlightRow('four') } selected={ selectedRows.four } highlighted={ highlightedRow === 'four' }>
                  <FlatTableCheckbox checked={ selectedRows.four } onChange={ () => handleSelectRow('four')} />
                  <FlatTableCell>Jane Smith</FlatTableCell>
                  <FlatTableCell>Newcastle</FlatTableCell>
                  <FlatTableCell>Married</FlatTableCell>
                  <FlatTableCell>5</FlatTableCell>
                </FlatTableRow>
              </FlatTableBody>
            </FlatTable>
          </SidebarContext.Provider>
        </>
      );
    }} 
  </Story>
</Preview>

## Table Cell Sizes

<Preview>
  <Story name="sizes">
    <div>
      {["compact", "small", "medium", "large"].map(size => <Box mb={3}>
        <FlatTable size={size}>
          <FlatTableHead>
            <FlatTableRow>
              <FlatTableHeader>Name</FlatTableHeader>
              <FlatTableHeader>Location</FlatTableHeader>
              <FlatTableHeader>Relationship Status</FlatTableHeader>
              <FlatTableHeader>Dependents</FlatTableHeader>
            </FlatTableRow>
          </FlatTableHead>
          <FlatTableBody>
            <FlatTableRow>
              <FlatTableCell>John Doe</FlatTableCell>
              <FlatTableCell>London</FlatTableCell>
              <FlatTableCell>Single</FlatTableCell>
              <FlatTableCell>0</FlatTableCell>
            </FlatTableRow>
            <FlatTableRow>
              <FlatTableCell>Jane Doe</FlatTableCell>
              <FlatTableCell>York</FlatTableCell>
              <FlatTableCell>Married</FlatTableCell>
              <FlatTableCell>2</FlatTableCell>
            </FlatTableRow>
            <FlatTableRow>
              <FlatTableCell>John Smith</FlatTableCell>
              <FlatTableCell>Edinburgh</FlatTableCell>
              <FlatTableCell>Single</FlatTableCell>
              <FlatTableCell>1</FlatTableCell>
            </FlatTableRow>
            <FlatTableRow>
              <FlatTableCell>Jane Smith</FlatTableCell>
              <FlatTableCell>Newcastle</FlatTableCell>
              <FlatTableCell>Married</FlatTableCell>
              <FlatTableCell>5</FlatTableCell>
            </FlatTableRow>
          </FlatTableBody>
        </FlatTable>
      </Box>)}
    </div>
  </Story>
</Preview>

## Props

### FlatTable
<Props of={FlatTable} />

### FlatTableHead
<Props of={FlatTableHead} />

### FlatTableBody
<Props of={FlatTableBody} />

### FlatTableRow
<Props of={FlatTableRow} />

### FlatTableHeader
<StyledSystemProps
  of={ FlatTableHeader }
  spacing
  defaults={{ py: 1, px: 3 }}
  noHeader
/>

### Sort
<Props of={Sort} />

### FlatTableCell
<StyledSystemProps
  of={ FlatTableCell }
  spacing
  defaults={{ py: '10px', px: 3 }}
  noHeader
/>

### FlatTableRowHeader
<StyledSystemProps
  of={ FlatTableRowHeader }
  spacing
  defaults={{ py: "10px", px: 3 }}
  noHeader
/>

### FlatTableCheckbox
<Props of={FlatTableCheckbox} />
