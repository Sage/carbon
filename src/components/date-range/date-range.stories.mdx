import { useState } from "react";
import { Meta, Story, Canvas } from "@storybook/addon-docs";
import StyledSystemProps from "../../../.storybook/utils/styled-system-props";
import TranslationKeysTable from "../../../.storybook/utils/translation-keys-table";

import DateRange from ".";
import I18nProvider from "../i18n-provider";
import { fr } from "../../locales/date-fns-locales";
import CarbonProvider from "../carbon-provider/carbon-provider.component";

<Meta title="Date Range" parameters={{ info: { disable: true } }} />

# Date Range

<a
  target="_blank"
  href="https://zeroheight.com/2ccf2b601/p/4122f0-date-range"
  style={{ color: '#007E45', fontWeight: 'bold', textDecoration: 'underline' }}
>
  Product Design System component 
</a>

Captures a start and end date.

Used to filter a Table of data according to a start and end date, or to set two dates which are related to each other, for example, a hotel booking.

## Contents

- [Quick Start](#quick-start)
- [Examples](#examples)
- [Props](#props)
- [Translation keys](#translation-keys)

## Quick Start

```javascript
import DateRange from "carbon-react/lib/components/date-range";
```

### Default

<Canvas>
  <Story name="default">
    {() => {
      const [state, setState] = useState(["01/10/2016", "30/10/2016"]);
      const handleChange = ({ target }) => {
        const newValue = [
          target.value[0].formattedValue,
          target.value[1].formattedValue,
        ];
        setState(newValue);
      };
      return (
        <DateRange
          startLabel="Start"
          endLabel="End"
          onChange={handleChange}
          value={state}
        />
      );
    }}
  </Story>
</Canvas>

### LabelsInline

<Canvas>
  <Story name="labelsInline">
    {() => {
      const [state, setState] = useState(["01/10/2016", "30/10/2016"]);
      const handleChange = ({ target }) => {
        const newValue = [
          target.value[0].formattedValue,
          target.value[1].formattedValue,
        ];
        setState(newValue);
      };
      return (
        <DateRange
          startLabel="Start"
          endLabel="End"
          onChange={handleChange}
          value={state}
          labelsInline
        />
      );
    }}
  </Story>
</Canvas>

### Validations

Validation status can be set by passing `startError`, `startWarning`, `startInfo`, `endError`, `endWarning` and `endInfo` props to the component.

Passing a string to these props will display a properly colored border along with a validation icon and tooltip - string value will be displayed as the tooltip message.

Passing a boolean to these props will display only a properly colored border.

For more information check our [Validations](?path=/docs/documentation-validations--page "Validations") documentation page

#### As a string

<Canvas>
  <Story name="validations - string - component">
    {() => {
      const [state, setState] = useState(["01/10/2016", "30/10/2016"]);
      const handleChange = ({ target }) => {
        const newValue = [
          target.value[0].formattedValue,
          target.value[1].formattedValue,
        ];
        setState(newValue);
      };
      return [
        { startError: "Start Error", endError: "End Error" },
        { startWarning: "Start Warning", endWarning: "End Warning" },
        { startInfo: "Start Info", endInfo: "End Info" },
      ].map((validation) => (
        <DateRange
          key={`${Object.keys(validation)[0]}-string-component`}
          startLabel="Start"
          endLabel="End"
          onChange={handleChange}
          value={state}
          {...validation}
        />
      ));
    }}
  </Story>
</Canvas>

It is possible to use the `tooltipPosition` to override the default placement of tooltips rendered as part of this component.

<Canvas>
  <Story
    name="validations - string - with tooltipPosition overriden - component"
    parameters={{ chromatic: { disable: true } }}
  >
    {() => {
      const [state, setState] = useState(["01/10/2016", "30/10/2016"]);
      const handleChange = ({ target }) => {
        const newValue = [
          target.value[0].formattedValue,
          target.value[1].formattedValue,
        ];
        setState(newValue);
      };
      return [
        { startError: "Start Error", endError: "End Error" },
        { startWarning: "Start Warning", endWarning: "End Warning" },
        { startInfo: "Start Info", endInfo: "End Info" },
      ].map((validation) => (
        <DateRange
          key={`${Object.keys(validation)[0]}-string-component`}
          startLabel="Start"
          endLabel="End"
          value={state}
          onChange={handleChange}
          {...validation}
          tooltipPosition="top"
        />
      ));
    }}
  </Story>
</Canvas>

#### As a string, displayed on label

<Canvas>
  <Story name="validations - string - label">
    {() => {
      const [state, setState] = useState(["01/10/2016", "30/10/2016"]);
      const handleChange = ({ target }) => {
        const newValue = [
          target.value[0].formattedValue,
          target.value[1].formattedValue,
        ];
        setState(newValue);
      };
      return [
        { startError: "Start Error", endError: "End Error" },
        { startWarning: "Start Warning", endWarning: "End Warning" },
        { startInfo: "Start Info", endInfo: "End Info" },
      ].map((validation) => (
        <DateRange
          key={`${Object.keys(validation)[0]}-string-label`}
          startLabel="Start"
          endLabel="End"
          value={state}
          onChange={handleChange}
          validationOnLabel
          {...validation}
        />
      ));
    }}
  </Story>
</Canvas>

It is possible to use the `tooltipPosition` to override the default placement of tooltips rendered as part of this component.

<Canvas>
  <Story
    name="validations - string - with tooltipPosition overriden - label"
    parameters={{ chromatic: { disable: true } }}
  >
    {() => {
      const [state, setState] = useState(["01/10/2016", "30/10/2016"]);
      const handleChange = ({ target }) => {
        const newValue = [
          target.value[0].formattedValue,
          target.value[1].formattedValue,
        ];
        setState(newValue);
      };
      return [
        { startError: "Start Error", endError: "End Error" },
        { startWarning: "Start Warning", endWarning: "End Warning" },
        { startInfo: "Start Info", endInfo: "End Info" },
      ].map((validation) => (
        <DateRange
          key={`${Object.keys(validation)[0]}-string-label`}
          startLabel="Start"
          endLabel="End"
          value={state}
          onChange={handleChange}
          validationOnLabel
          {...validation}
          tooltipPosition="top"
        />
      ));
    }}
  </Story>
</Canvas>

#### New designs validation

Longer validation strings that would exceed the input width will wrap to a new line. Inputs 
should remain aligned but labels may no longer be when a string wraps. Label text that would 
exceed the input widht will also wrap to a new line.

<Canvas>
  <Story name="validations - string - new design">
    {() => {
      const [state, setState] = useState(["01/10/2016", "30/10/2016"]);
      const handleChange = ({ target }) => {
        const newValue = [
          target.value[0].formattedValue,
          target.value[1].formattedValue,
        ];
        setState(newValue);
      };
      return (
        <CarbonProvider validationRedesignOptIn>
          {[
            { startError: "Start error with long text string", endError: "End error" },
            { startWarning: "Start warning", endWarning: "End warning with long text string" },
          ].map((validation) => (
            <DateRange
              key={`${Object.keys(validation)[0]}-string-component`}
              startLabel="Start"
              endLabel="End"
              onChange={handleChange}
              value={state}
              {...validation}
              m={4}
            />
          ))}
        </CarbonProvider>
      );
    }}
  </Story>
</Canvas>

#### As a boolean

<Canvas>
  <Story name="validations - boolean">
    {() => {
      const [state, setState] = useState(["01/10/2016", "30/10/2016"]);
      const handleChange = ({ target }) => {
        const newValue = [
          target.value[0].formattedValue,
          target.value[1].formattedValue,
        ];
        setState(newValue);
      };
      return [
        { startError: true, endError: true },
        { startWarning: true, endWarning: true },
        { startInfo: true, endInfo: true },
      ].map((validation) => (
        <DateRange
          key={`${Object.keys(validation)[0]}-boolean-component`}
          startLabel="Start"
          endLabel="End"
          value={state}
          onChange={handleChange}
          {...validation}
        />
      ));
    }}
  </Story>
</Canvas>

### Allow Empty Value

You can pass prop `allowEmptyValue` to start and end `DateInput` using `startDateProps` and `endDateProps`.

<Canvas>
  <Story name="allowEmptyValue">
    {() => {
      const [state, setState] = useState(["", ""]);
      const handleChange = ({ target }) => {
        const newValue = [
          target.value[0].formattedValue,
          target.value[1].formattedValue,
        ];
        setState(newValue);
      };
      return (
        <DateRange
          startLabel="Start"
          endLabel="End"
          value={state}
          startDateProps={{
            allowEmptyValue: true,
          }}
          endDateProps={{
            allowEmptyValue: true,
          }}
          onChange={handleChange}
        />
      );
    }}
  </Story>
</Canvas>

### Locale override

The examples below illustrates how to override the locale passed into the DateRange component. In this example it has been set up for
the French locale. Required locales can be imported like so `import { fr } from 'carbon-react/lib/locales/date-fns-locales';`

<Canvas>
  <Story
    name="locale override - example implementation"
    parameters={{ chromatic: { disable: true } }}
  >
    {() => {
      const [state, setState] = useState(["01/10/2016", "30/10/2016"]);
      const handleChange = ({ target }) => {
        const newValue = [
          target.value[0].formattedValue,
          target.value[1].formattedValue,
        ];
        setState(newValue);
      };
      return (
        <div>
          <I18nProvider
            locale={{
              locale: () => "fr-FR",
              date: { dateFnsLocale: () => fr },
            }}
          >
            <DateRange
              startLabel="Start"
              endLabel="End"
              value={state}
              onChange={handleChange}
            />
          </I18nProvider>
        </div>
      );
    }}
  </Story>
</Canvas>

## Props

### Date Range

<StyledSystemProps of={DateRange} noHeader margin />

## Translation keys

The following keys are available to override the translations for this component by passing in a custom locale object to the
[i18nProvider](https://carbon.sage.com/?path=/story/documentation-i18n--page).

<TranslationKeysTable
  translationData={[
    {
      name: "date.dateFnsLocale",
      description:
        "The locale object from date-fns, example of implementation can be found [here](#locale-override)",
      type: "func",
      returnType: "date-fns locale object",
    },
  ]}
/>
