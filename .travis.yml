language: node_js
node_js: node

cache:
  npm: true
  directories:
    - ~/.cache

addons:
   apt:
     packages:
       # Ubuntu 16+ does not install this dependency by default, so we need to install it ourselves
       - libgconf-2-4

stages:
  - test
  - regression
  - deploy

jobs:
  fast_finish: true
  include:
    - stage: test
      name: "lint"
      script: echo "Linting"
    - &cypress-travis-regression
      stage: regression
      name: Cypress regression
      parallelism: 100
      script:
        - npm run storybook-ci </dev/null &>/dev/null &
        - wait-on http://localhost:9001
      commands:
        - <<: *cypress-travis-regression
          npm run cypress-group-regression-common
        - <<: *cypress-travis-regression
          npm run cypress-group-regression-experimental
        - <<: *cypress-travis-regression
          npm run cypress-group-regression-deprecated
        - <<: *cypress-travis-regression
          npm run cypress-group-regression-validations
        - <<: *cypress-travis-regression
          npm run cypress-group-regression-themes
        - <<: *cypress-travis-regression
          npm run test-cypress-build
        - <<: *cypress-travis-regression
          npm run test-cypress-accessibility